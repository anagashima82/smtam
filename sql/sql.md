---
marp: true
theme: custom
footer: "**SAMURAI データベース基礎講座**"
paginate: true

title: "1章 データベース基礎講座"
subtitle: "データベースの概要を学ぼう"
author: "SAMURAI"
date: "2025-11-01"

---

<!-- _class: title -->
# データベース基礎講座
## テキスト
---

<!-- _class: title-top -->

## 目次（1日目）

<div style="font-size: 0.85em; line-height: 1.8;">

- **1章** データベースの概要を学ぼう
- **2章** SQLの概要を学ぼう
- **3章** データ型の種類を学ぼう
- **4章** データベースとテーブルを作ろう
- **5章** データベースとテーブルを取得しよう
- **6章** データベースとテーブルを削除しよう
- **7章** データを取得しよう
- **8章** データを追加・更新しよう
- **9章** データを削除しよう
- **10章** 特定のデータを検索しよう

</div>

---

<!-- _class: title-top -->

## 目次（2日目）

<div style="font-size: 0.85em; line-height: 1.8;">

- **11章** より複雑なデータを検索しよう
- **12章** 取得するデータ数の上限を設定しよう
- **13章** 取得するデータを並び替えよう
- **14章** 関数を使ってデータを集計しよう
- **15章** 取得するデータをグループ化しよう
- **16章** 2つのテーブルを結合しよう
- **17章** 3つ以上のテーブルを結合しよう
- **18章** データベースの設計方法を学ぼう
- **19章** サブクエリとWITH句を学ぼう

</div>

---

<!-- _class: title -->

# 1章 データベースの概要を学ぼう
---


<!-- _class: title-top -->

## 1章 データベースの概要を学ぼう

Web開発におけるデータベースの概要と重要性を学びます。

**本章の目標**
- データベースの概要を知ること

---
<!-- _class: title-top -->

## 1章 データベースとは

<div class="no-bg">

**データベースとは、複数のデータをまとめて扱いやすくしたものです。**


</div>

- 英語のDatabaseを略して、**DB**（デービーまたはディービー）と呼ばれる
- 大量の複雑なデータを効率的に保存・管理できる
- さまざまなソフトウェアのデータ管理に使われる

---
<!-- _class: title-top -->

## 1章 データベースとは
<div class="image-center">

![width:1000px](./images/SQL-1-1.png)

</div>

---
<!-- _class: title-top -->

## 1章 データベースが必要な理由

<div class="flex sa">
<div>

### ショッピングサイトの例

管理すべきデータ：
- アカウント情報
- 商品データ
- 購入履歴

</div>
<div>

### データベースの利点

- データの種類ごとにまとまりを作って管理
- SQLという命令文でデータの追加・変更・削除が可能
- 決められたルールに沿った効率的なデータ管理

</div>
</div>

---
<!-- _class: title-top -->

## 1章 データベースが必要な理由

<div class="image-center">

![width:1000px](./images/SQL-1-2.png)

</div>

---
<!-- _class: title-top -->

## 1章 データベースの仕組み

<div class="flex-3col">
<div>

### DBサーバー

データベースを扱うためのコンピューター

- Webアプリケーション用のサーバーと分けることが多い

</div>
<div>

### DBMS

データベース管理システム

- データベースの構築や操作を行うソフトウェア
- 単に「データベース」という場合、DBMSを指すことが多い

</div>
<div>

### SQL

Structured Query Language

- データベースの構築や操作を行うための言語
- DBMSはSQLを処理してデータベースを操作

</div>
</div>

---
<!-- _class: title-top -->

## 1章 データベースの仕組み
<div class="image-center">

![width:1000px](./images/SQL-1-3.png)

</div>

---
<!-- _class: title-top -->

## 1章 SQLクエリとは

<div class="no-bg">

**SQLクエリ（命令文）を通してデータベースを操作します。**

</div>

- クエリ（query）とは「問い合わせ」という意味の英単語
- ITの世界では、ソフトウェアにデータを要求する命令文を指す
- 単に「クエリ」と呼ぶこともある

<div class="no-bg">

**実行方法**

</div>

- コマンドプロンプト（Windows）やターミナル（Mac）でも実行可能
- Webアプリケーションでは、SQLをプログラムに埋め込んで実行することが多い

---
<!-- _class: title-top -->

## 1章 データベースの種類

<div class="flex-3col">
<div>

### リレーショナル型

- 行と列を持つ表形式
- 古くからWeb開発でよく使われる
- **本教材で扱う形式**

</div>
<div>

### 階層型

- ツリー構造でデータを管理
- 親子関係が明確

</div>
<div>

### NoSQL型

- 非リレーショナル型
- 柔軟なデータ構造
- 大規模データ処理に向く

</div>
</div>

---
<!-- _class: title-top -->

## 1章 データベースの種類
<div class="image-center">

![width:1000px](./images/SQL-1-4.png)

</div>
---
<!-- _class: title-top -->

## 1章 リレーショナル型データベースの特徴

それぞれの表を**テーブル**と呼びます。

関連性（リレーションシップ）のあるテーブル同士を結びつけてデータを管理するのが名前の由来です。

**SNSの例：**
- 「ユーザー情報テーブル」と「つぶやき投稿テーブル」
- 2テーブルはユーザーIDで関連付けられる
- 投稿者の名前を知りたい場合、ユーザーIDをもとに「ユーザー情報テーブル」を探す

---
<!-- _class: title-top -->

## 1章 リレーショナル型データベースの頻出用語

| 用語 | 説明 |
|------|------|
| **テーブル** | 1つひとつの表 |
| **カラム** | テーブルにおける縦1列 |
| **レコード** | テーブルにおける横1行 |
| **フィールド** | テーブルにおける1つひとつのデータ |

---
<!-- _class: title-top -->

## 1章 DBMS（データベース管理システム）の種類

| DBMS名 | 特徴 | 費用 |
|--------|------|------|
| **MySQL** | Oracle社が管理するオープンソースのDBMS。処理速度に優れ、Web開発に向いている。 | 無償(有償) |
| **PostgreSQL** | MySQLと同様にオープンソースのDBMS。複雑なSQLクエリを扱えるなど高機能で、データ分析に向いている。 | 無償 |
| **Oracle Database** | Oracle社が開発・販売する商用データベース。高機能・高性能。 | 有償(無償) |
| **Microsoft SQL Server** | Microsoft社が開発・販売する商用データベース。Windows環境と相性が良く、GUIによる直感的な操作が可能。 | 有償 |

---
<!-- _class: title-top -->

## 1章 本教材で使用するDBMS

<div class="flex sa">
<div>

### MySQL

- 無償で使える
- Web開発と相性が良い
- 処理速度に優れる

**本教材で導入予定**

</div>
<div>

### SQLは世界標準

- MySQLで学んだSQLは他のDBMSでも使える
- 基本的に同様の書き方でデータベースを操作可能
- 一度学べば応用が効く

</div>
</div>

---
<!-- _class: title-top -->

## 1章 まとめ

### データベース（DB）とは、複数のデータをまとめて扱いやすくしたもの

#### データベースの構成要素

- データベースサーバー（DBサーバー）
- データベース管理システム（DBMS）
- SQL（Structured Query Language）

#### リレーショナル型データベース

- テーブル、カラム、レコード、フィールド
- 関連性のあるテーブル同士を結びつけてデータを管理

---
<!-- _class: title-top -->

## 1章 まとめ（続き）

### 代表的なDBMS

- MySQL（本教材で使用）
- PostgreSQL
- Oracle Database
- Microsoft SQL Server

Webアプリケーションはもちろん、データを扱うソフトウェアにはデータベースが必要不可欠です。

---

<!-- _class: title -->

# 2章 SQLの概要を学ぼう

---

<!-- _class: title-top -->

## 2章 SQLの概要を学ぼう

データベースを操作するSQLの概要と用語について学びます。

**本章の目標**
- SQLを知ること
- SQLで使う用語とコマンドを知ること
- SQLとMySQLの違いを知ること

---
<!-- _class: title-top -->

## 2章 SQLとは

<div class="no-bg">

**SQL（Structured Query Language）とは、データベースを操作するための言語のことです。**

</div>

- 読み方は「エスキューエル」または「シーケル」
- データベース言語の1つ

**SQLでできる主な操作**
- データの検索・追加・更新・削除
- テーブルの作成・削除
- データベースの権限や文字コードの設定

---
<!-- _class: title-top -->

## 2章 SQLの特徴

<div class="flex sa">
<div>

### 英語のように構文が決まっている

- 型どおりに実行しないとエラーが発生
- 例：
```sql
INSERT INTO test.users
(id, name, age)
VALUES (1, '佐藤', 25);
```

</div>
<div>

### データベース言語である

| SQL | プログラミング言語 |
|-----|------------------|
| データベースに対してのみ操作命令 | ユーザー画面側とDBの橋渡し |
| 単純な命令のみ | 複雑な命令を実行可能 |
| プログラム内に記述可能 | 異なる言語とは共存不可 |

</div>
</div>

---
<!-- _class: title-top -->

## 2章 SQLの命令方法

<div class="flex sa">
<div>

### 対話型

- ユーザーが直接SQLのコマンドを打ち込む方法
- ターミナル（Mac）やコマンドプロンプト（Windows）を利用
- 会話のキャッチボールのように、1行書いたらすぐに実行される

</div>
<div>

### 埋め込み型

- ソースコード（PHPやRubyなど）にSQLを埋め込む方法
- 複雑な操作を行いたい場合に用いる
- **Webアプリ開発では基本的に埋め込み型を利用**

</div>
</div>

**ISO（国際標準化機構）で標準化されている**
- 一度学習すればどのデータベースでも同じように操作できる

---
<!-- _class: title-top -->

## 2章 SQLでよく使う用語

| Excel・Googleスプレッドシート | SQL |
|---------------------------|-----|
| 表、シート | テーブル |
| 列 | カラム |
| 行 | レコード |
| セル | フィールド |

**テーブル**
- データを保存しておく場所で、表全体に当たる部分
- 例：usersテーブル、shopsテーブル、itemsテーブル
- データは複数あるため、テーブル名は複数形にする慣例がある

---
<!-- _class: title-top -->

## 2章 SQLでよく使う用語（続き）

<div class="flex sa">
<div>

### カラム

- テーブルの縦1列のこと
- 1番上は、そのカラム内のデータを総称する文字が入る

### レコード

- テーブルの横1行のこと
- 1番上の行は「ヘッダー部分」と呼ばれる

</div>
<div>

### フィールド

- テーブル内の1マスのデータ
- Webアプリではフィールド内のデータを1つずつ取得し、使用する

</div>
</div>

---
<!-- _class: title-top -->

## 2章 SQLでよく使うコマンド

| コマンド名 | 役割 |
|----------|------|
| **CREATE** | 新しくテーブルを作成 |
| **DROP** | テーブルを削除 |
| **INSERT** | テーブル内に新しくカラムやレコードを挿入 |
| **SELECT** | テーブルから対象となるカラム、レコード、フィールドを選択し取得 |
| **UPDATE** | 特定の条件で選択した列の値を更新 |
| **DELETE** | 特定の条件で選択した行の値を削除 |
| **WHERE** | 条件に一致するデータを取得 |
| **ORDER BY** | データを昇順、降順に入れ替え |

---
<!-- _class: title-top -->

## 2章 SQLとMySQLの違い

| 特性 | 解説 |
|------|------|
| **MySQL** | データベース。「テーブル」「カラム」「レコード」「フィールド」を含んだデータベースそのもの。データを保管するための箱。 |
| **SQL** | データベース言語。MySQLを操作できるデータベース言語。「CREATE」「INSERT」などのコマンド。 |

<div class="no-bg">

**SQLはMySQLを操作する言語である**

</div>

---
<!-- _class: title-top -->

## 2章 SQL文の命令の種類

<div class="flex-3col">
<div>

### DDL（データ定義言語）

- テーブルを作成
- カラムを追加

**主なコマンド**
- CREATE
- DROP

</div>
<div>

### DML（データ操作言語）

- データの取得、追加、更新、削除

**主なコマンド**
- SELECT
- INSERT
- UPDATE
- DELETE

</div>
<div>

### DCL（データ制御言語）

- 操作する権限を設定

**主なコマンド**
- GRANT
- REVOKE

</div>
</div>

---
<!-- _class: title-top -->

## 2章 SQLの書き方のルール

### 厳守しないとエラーが発生するルール

| ルール | 例 |
|--------|-----|
| 文字列は「'（シングルクォート）」で囲む | '佐藤'、'Hello World' |
| 数値は何も囲わない | 1、50 |
| データの文字列以外は半角英数字で記述 | ()、,（カンマ） |

### 開発現場の一般的なルール

| ルール | 例 |
|--------|-----|
| SQLのコマンドは大文字で書く | INSERT、INTO |
| データベース、テーブル、カラム名は小文字で書く | id、name、age |

---
<!-- _class: title-top -->

## 2章 まとめ

### SQLはデータベースのデータを追加・削除・更新などができる言語

- SQLはコマンドを大文字、保管するデータを小文字で書く場合が多い
- MySQLはデータベースそのもの、SQLはデータを操作するコマンド

### SQLのコマンドは3種類に大別できる

- **データ定義言語（DDL）**：テーブル作成・削除
- **データ操作言語（DML）**：データの取得・追加・更新・削除
- **データ制御言語（DCL）**：操作権限の設定

---

<!-- _class: title -->

# 3章 データ型の種類を学ぼう

---

<!-- _class: title-top -->

## 3章 データ型の種類を学ぼう

データベースにおけるデータの種類と型を学びます。

**本章の目標**
- データベースにおけるデータの種類と型を理解すること

---
<!-- _class: title-top -->

## 3章 データ型とは

<div class="no-bg">

**SQLで取り扱うデータには、その種類を表す「データ型」があります。**

</div>

- データ型は、テーブル作成時のカラムに設定
- データ追加時は、各々のカラムに合致したデータ型しか保管できない

**データ型の主な種類**
- 数値型
- 文字列型
- 日付型
- 論理型

---
<!-- _class: title-top -->

## 3章 よく使うデータ型

| データ型 | 種類 | 解説 |
|---------|------|------|
| 数値型 | **int**（イント） | 整数を指し、正の数と負の数を扱える。 |
| 数値型 | **float**（フロート） | 小数の数値で、小数第7位まで設定できる。 |
| 文字列型 | **varchar**（バーチャー） | 自由な文字数をデータベースに保管する。 |
| 文字列型 | **text**（テキスト） | varcharよりも多くの文字数をデータベースに保管するときに使う。 |
| 日付型 | **date**（デート） | 年月日の日付。「2022-5-22」のようなデータを保管する。 |
| 日付型 | **datetime**（デートタイム） | 日付と時刻を指定。「2022-5-22 12:34:23」の形式でデータを保管する。 |
| 論理型 | **boolean**（ブーリアン） | 真偽値である「TRUE：真」、「FALSE：偽」を指定する。 |

---
<!-- _class: title-top -->

## 3章 数値型

<div class="image-center">

![width:1000px](./images/SQL-3-1.png)

</div>

---
<!-- _class: title-top -->

## 3章 数値型の特徴

<div class="no-bg">


</div>

### **データベースでの使用例**
- 金額、年齢、ユーザーIDなどのカラムを数値型として設定
- データ同士を計算し、合算や平均値として取得することが可能

### **int型**
- 正負を含めた整数を取り扱う
- データベースの操作において、最もよく使う数値型
- 「int (11)」のように、丸括弧()内に何桁までの数値を保管するか指定

### **float型**
- 浮動小数点を扱える数値型
- 小数第7位まで正確に計算できる

---
<!-- _class: title-top -->

## 3章 文字列型

<div class="image-center">

![width:1000px](./images/SQL-3-2.png)

</div>

---
<!-- _class: title-top -->

## 3章 文字列型の特徴

<div class="no-bg">

**文字列型は、「こんにちは」や「I am Tanaka.」など文字を表すデータ型です。**

</div>

### **データベースでの使用例**
- ユーザー名、住所、電話番号などのカラムを文字列型として設定
- 「090-1234-5678」のような電話番号は、「-（ハイフン）」を入れる場合は数値型では扱えないため文字列型

### **varchar型**
- 可変長の文字列型
- 上限は8,000文字以内
- 「varchar (256)」のように、丸括弧()内に文字数の上限を指定

### **text型**
- 可変長の文字列型で、varchar型と同じ長さの文字列を扱える
- 文字列の「ポインタ」を保管することで、文字列のサイズを圧縮できる
- 256文字程度の短文ならvarchar型、それ以上の長文ならtext型と使い分ける

---
<!-- _class: title-top -->

## 3章 日付型

<div class="image-center">

![width:1000px](./images/SQL-3-3.png)

</div>

---
<!-- _class: title-top -->

## 3章 日付型の特徴

<div class="no-bg">

**日付型は「2022-05-24 12:32:34」などの日時を表すデータ型です。**

</div>

### **データベースでの使用例**
- 作成日時、更新日時、削除日時のカラムを日付型として設定
- 日付型を設定するときは、どのゾーンの日付なのかを決める（例：「アジア／東京」）

### **date型**
- 日付（年月日）のみを取り扱うデータ型

### **datetime型**
- 日付（年月日）と時刻、両方を取り扱うデータ型
- より詳細な日時を取得したい場合に使う

---
<!-- _class: title-top -->

## 3章 論理型

<div class="image-center">

![width:1000px](./images/SQL-3-4.png)

</div>

---
<!-- _class: title-top -->

## 3章 論理型の特徴

<div class="no-bg">

**boolean型が論理型といわれるデータ型です。**

</div>

- データベースに格納されるのは、0か1のいずれか
- 0をFALSE（偽）、1をTRUE（真）として表現

**データベースでの使用例**
- 記事データの公開・非公開を判断する場合
  - 「公開」なら1
  - 「非公開」なら0

---
<!-- _class: title-top -->

## 3章 まとめ

### データ型の設定ルール

- **金額、年齢などの数値**を保管する場合は、intやfloatの**数値型**をカラムに設定
- **ユーザー名、住所などの文字列**を保管する場合は、varcharやtextの**文字列型**をカラムに設定
- **日付、時刻**を保管する場合は、dateやdatetimeの**日付型**をカラムに設定
- **公開・非公開などの2択**に関するデータを保管する場合は、booleanの**論理型**をカラムに設定

---

<!-- _class: title -->

# 4章 データベースとテーブルを作ろう

---

<!-- _class: title-top -->

## 4章 データベースとテーブルを作ろう

SQLによるデータベースとテーブルを作成する方法を学びます。

**本章の目標**
- データベースやテーブルを作成するCREATE文の使い方を知ること

---
<!-- _class: title-top -->

## 4章 CREATE文とは

<div class="no-bg">

**CREATE文は、データベースやテーブルを作成するSQL命令です。**

</div>

- CREATEは「作成する」という意味
- 「このようなデータベースやテーブルを作成してください」と命令を送るコマンド

**CREATE文の基本的な書き方**
```sql
-- データベースを作成する
CREATE DATABASE データベース名;

-- テーブルを作成する
CREATE TABLE テーブル名 (カラム名 データ型, ......);
```

---
<!-- _class: title-top -->

## 4章 CREATE文の特徴

<div class="no-bg">

**英語の命令文のように、「動詞＋目的語」の形をとっています。**

</div>

**データベースの作成**
- `CREATE DATABASE` のあとにデータベース名（英小文字）を記述
- 「○○という名前のデータベースを作成してください」という命令

**テーブルの作成**
- `CREATE TABLE` のあとにテーブル名（英小文字）を記述
- 「○○という名前のテーブルを作成してください」という命令

---
<!-- _class: title-top -->

## 4章 usersテーブルのCREATE文

```sql
CREATE TABLE IF NOT EXISTS users (
    id INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR (256) NOT NULL,
    furigana VARCHAR (256) NOT NULL,
    email VARCHAR (256) NOT NULL,
    age INT (11),
    address VARCHAR (256)
);
```

**ポイント**
- 大文字：SQLの命令文やデータ型、オプション
- 小文字：テーブル名やカラム名

---
<!-- _class: title-top -->

## 4章 PRIMARY KEYとは

<div class="no-bg">

**PRIMARY KEY（プライマリーキー、主キー）とは、テーブルに保存しているレコードを一意に識別するためのカラムのことです。**

</div>

**特徴**
- 一意に識別する = 他に同じ値が存在せず、いずれか1つに特定すること
- idという名前のカラムにPRIMARY KEYを設定した場合、idが「1」のレコードは1つしか存在し得ない
- id = 1という条件で検索すれば、必ず1つのレコードのみがその条件に一致

**設定例**
- ユーザーID、社員番号など一意（重複する値が存在しない）カラムに設定

---
<!-- _class: title-top -->

## 4章 NOT NULLとは

<div class="no-bg">

**NOT NULLは「データが何もない状態を認めません」という意味です。**

</div>

**NULLとは**
- 「データが何もない状態」を表す

**NOT NULLの効果**
- NOT NULLを設定した場合、そのカラムに値を入れないままデータを追加しようとするとエラーが発生
- 例：ショッピングサイトでは、商品を発送するために住所のデータは必須。住所を保存するカラムにNOT NULLを設定

**注意点**
- **NULLと0（ゼロ）は別物**
- NULLは「データが何もない状態」、0は「存在するデータ」として扱われる

---
<!-- _class: title-top -->

## 4章 まとめ

### データベースとテーブルを作成するSQL

```sql
-- データベースを作成する
CREATE DATABASE データベース名;

-- テーブルを作成する
CREATE TABLE テーブル名 (カラム名 データ型, ......);
```

### 重要なポイント

- **CREATE文**でデータベースとテーブルを作成
- **PRIMARY KEY**でレコードを一意に識別
- **NOT NULL**でデータの空を防止

---

<!-- _class: title -->

# 5章 データベースとテーブルを取得しよう

---

<!-- _class: title-top -->

## 5章 データベースとテーブルを取得しよう

SQLによるデータベースとテーブルの一覧を取得する方法を学びます。

**本章の目標**
- データベースやテーブルを取得する方法を理解すること
- SHOW文の使い方を知ること

---
<!-- _class: title-top -->

## 5章 SHOW文とは

<div class="no-bg">

**SHOW文は、データベースやテーブルの一覧を表示するSQL命令です。**

</div>

- SHOWは「見せる」という意味
- データベースやテーブルなどに対して「一覧を見せてください」と命令を送るコマンド
- すでに存在するデータベースやテーブルの一覧を確認したいときに使う

---
<!-- _class: title-top -->

## 5章 SHOW文の基本的な書き方

```sql
-- データベースの一覧を表示する
SHOW DATABASES;

-- テーブルの一覧を表示する
SHOW TABLES;
```

<div class="no-bg">

**重要なポイント**

</div>

- `DATABASES` や `TABLES` のように、**複数形**になっている点に注意
- 存在するデータベースやテーブルの一覧を「すべて」表示するので複数形にする

---
<!-- _class: title-top -->

## 5章 データベースの一覧を取得してみよう

**SHOW DATABASES文の実行**

```sql
SHOW DATABASES;
```

<div class="no-bg">

**実行結果**

</div>

- SQL文の実行が成功すると、現在のMySQL（MariaDB）内に存在するデータベースの一覧が表示される
- 自分が作成したデータベース（例：lesson）や、システムが使用するデータベースなどが表示される

---
<!-- _class: title-top -->

## 5章 データベース一覧の例

### **SHOW DATABASES;の実行結果例**

| Database |
|----------|
| information_schema |
| lesson |
| mysql |
| performance_schema |

<div class="no-bg">

### **各データベースの説明**

</div>

- **lesson**: 自分が作成したデータベース（前章で作成）
- **information_schema, mysql, performance_schema**: システムが使用するデータベース

---
<!-- _class: title-top -->

## 5章 テーブルの一覧を取得してみよう

### **SHOW TABLES文の実行**

```sql
SHOW TABLES;
```

<div class="no-bg">

**重要なポイント**

</div>

- テーブル一覧を取得する場合は、**事前にデータベースを選択する必要がある**
- データベースを選択するには、`USE データベース名;` コマンドを使用

**例：lessonデータベースのテーブル一覧を取得**
```sql
USE lesson;
SHOW TABLES;
```

---
<!-- _class: title-top -->

## 5章 テーブル一覧の取得例

### **lessonデータベース内のテーブル一覧**

```sql
USE lesson;
SHOW TABLES;
```

**実行結果例**

| Tables_in_lesson |
|------------------|
| users |

<div class="no-bg">

**結果の説明**

</div>

- データベース「lesson」内に存在するテーブル一覧が表示される
- 前章で作成した「users」テーブルが表示される

---
<!-- _class: title-top -->

## 5章 USE文とは

<div class="no-bg">

### **USE文は、操作対象のデータベースを選択するSQL命令です。**

</div>

**書き方**
```sql
USE データベース名;
```


**ポイント**
- データベースを選択した後は、そのデータベース内のテーブルに対して操作を行える
- テーブル一覧を取得する前に、USE文でデータベースを選択する必要がある

---
<!-- _class: title-top -->

## 5章 まとめ

### データベースとテーブルの一覧を表示するSQL

```sql
-- データベースの一覧を表示する
SHOW DATABASES;
-- テーブルの一覧を表示する
SHOW TABLES;
-- データベースを選択する
USE データベース名;
```

### 重要なポイント

- **SHOW DATABASES**でデータベースの一覧を表示
- **SHOW TABLES**でテーブルの一覧を表示
- テーブル一覧を取得する前に**USE文**でデータベースを選択
- DATABASES、TABLESは**複数形**で記述

---

<!-- _class: title -->

# 6章 データベースとテーブルを削除しよう

---

<!-- _class: title-top -->

## 6章 データベースとテーブルを削除しよう

SQLによるデータベースとテーブルを削除する方法を学びます。

**本章の目標**
- データベースやテーブルを削除する方法を理解すること
- DROP文の使い方を知ること

---
<!-- _class: title-top -->

## 6章 DROP文とは

<div class="no-bg">

**DROP文は、データベースやテーブルを削除するSQL命令です。**

</div>

- DROPは「落とす」という意味
- 「データベースやテーブルを削除してください」と命令を送るコマンド
- 不要になったデータベースやテーブルを削除するときに使う

**重要な注意点**
- **データベースを削除すると中身のテーブルも削除される**
- 削除は取り消せないため、十分考慮してから実行する

---
<!-- _class: title-top -->

## 6章 DROP文の基本的な書き方

```sql
-- データベースを削除する
DROP DATABASE データベース名;

-- テーブルを削除する
DROP TABLE テーブル名;
```

<div class="no-bg">

**重要な注意点**

</div>

- データベースを削除すると**中身のテーブルも削除される**
- よって、データベースを削除するときは十分考慮してから行う



---
<!-- _class: title-top -->

## 6章 まとめ

### データベースとテーブルを削除するSQL

```sql
-- データベースを削除する
DROP DATABASE データベース名;
-- テーブルを削除する
DROP TABLE テーブル名;
```

### 重要なポイント

- **DROP DATABASE**でデータベースを削除
- **DROP TABLE**でテーブルを削除
- データベースを削除すると中のテーブルも削除される
- **削除は取り消せない**ため、慎重に実行
- 実行前にSHOW文で確認することを推奨

---

<!-- _class: title -->

# 7章 データを取得しよう

---

<!-- _class: title-top -->

## 7章 データを取得しよう

SQLによるデータ操作のうち、取得について学びます。

**本章の目標**
- 再度データベースとテーブルを作成すること
- テーブルにダミーデータを追加すること
- SQLでテーブル内のデータを取得する方法を知ること

---
<!-- _class: title-top -->

## 7章 データ操作の重要性

<div class="no-bg">

### **「SQLによるデータベース操作」とは、そのほとんどが「テーブル内に存在するデータの操作」のことを指します。**

</div>

**投稿アプリの例**
- 投稿一覧の表示
- 新規投稿
- 投稿の編集
- 投稿の削除

**重要なポイント**
- データ操作の基本は「取得（SELECT）」

---
<!-- _class: title-top -->

## 7章 SELECT文とは

<div class="no-bg">

### **SELECT文は、テーブル内のデータを取得するSQL命令です。**

</div>

- SELECTは「選択する」という意味
- テーブルに対して「○○というカラムを選択（取得）してください」と命令
- アプリやサービスでは商品一覧や投稿一覧など、画面にデータを表示したいときに使う

### **主な用途**
- データの一覧表示
- 特定の条件でデータを検索
- データの集計や分析

---
<!-- _class: title-top -->

## 7章 SELECT文の基本的な書き方

### **1つのカラムのデータを取得する場合**
```sql
SELECT カラム名 FROM テーブル名;
```

### **複数のカラムのデータを取得する場合**
```sql
SELECT カラム名1, カラム名2, カラム名3 FROM テーブル名;
```

### **すべてのカラムのデータを取得する場合**
```sql
SELECT * FROM テーブル名;
```

<div class="no-bg">

**ポイント：すべてのカラムを取得する場合は、カラム名の箇所を `*`（アスタリスク）にする**

</div>

---
<!-- _class: title-top -->

## 7章 SELECT文を実行してみよう

### **usersテーブルからnameカラムを取得**

```sql
SELECT name FROM users;
```

<div class="no-bg">

**実行前の準備**

</div>

- データベース「lesson」を選択（`USE lesson;`）
- usersテーブルにダミーデータが追加されていることを確認

### **実行結果**
- usersテーブルに保存されているnameカラムの値が取得される
- 複数のレコードがある場合は、すべて表示される

---
<!-- _class: title-top -->

## 7章 SELECT文の実行例

<div class="flex sa">
<div>

### 1つのカラムを取得

```sql
USE lesson;
SELECT name FROM users;
```

**実行結果（例）**
- 田中太郎
- 佐藤花子
- 鈴木一郎
- ...

</div>
<div>

### 複数のカラムを取得

```sql
USE lesson;
SELECT name, age FROM users;
```

**実行結果（例）**
- 田中太郎, 25
- 佐藤花子, 30
- 鈴木一郎, 22
- ...

</div>
</div>

---
<!-- _class: title-top -->

## 7章 すべてのカラムを取得

**`*`（アスタリスク）を使ってすべてのカラムを取得**

```sql
USE lesson;
SELECT * FROM users;
```

<div class="no-bg">

**実行結果**

</div>

- usersテーブルのすべてのカラム（id、name、furigana、email、age、address）が取得される
- テーブル構造を確認したい場合や、すべてのデータを表示したい場合に便利
- 本番環境では必要なカラムだけを指定することを推奨（パフォーマンスのため）

---
<!-- _class: title-top -->

## 7章 まとめ

### SELECT文の基本的な書き方

```sql
-- 1つのカラムのデータを取得する場合
SELECT カラム名 FROM テーブル名;
-- 複数のカラムのデータを取得する場合
SELECT カラム名1, カラム名2, カラム名3 FROM テーブル名;
-- すべてのカラムのデータを取得する場合
SELECT * FROM テーブル名;
```

### 重要なポイント

- **SELECT文**でテーブル内のデータを取得
- カラム名を指定して特定のカラムのみ取得可能
- `*`（アスタリスク）ですべてのカラムを取得可能
- データベース操作の基本であり、最も頻繁に使用するSQL文

---

<!-- _class: title -->

# 8章 データを追加・更新しよう

---

<!-- _class: title-top -->

## 8章 データを追加・更新しよう

SQLによるデータ操作のうち、追加と更新について学びます。

**本章の目標**
- SQLでテーブル内のデータを追加および更新する方法を知ること
- SQLでテーブルにコメントを追加する方法を知ること

---
<!-- _class: title-top -->

## 8章 データ追加・更新の重要性

<div class="no-bg">

**アプリやサービス開発では、データを追加したり更新したりする操作が必須です。**

</div>

**投稿アプリの例**
- **新規投稿** → データの追加
- **投稿の編集** → データの更新

**重要なポイント**
- データの追加はINSERT文
- データの更新はUPDATE文
- どちらもアプリ開発で頻繁に使用する

---
<!-- _class: title-top -->

## 8章 INSERT文とは

<div class="no-bg">

**INSERT文は、テーブル内にデータを追加するSQL命令です。**

</div>

- INSERTは「挿入する」という意味
- テーブルに対して「○○というデータを追加してください」と命令
- アプリやサービスでは会員登録や新規投稿など、新しくデータを追加する際に使う

**主な用途**
- 会員登録（新規ユーザーデータの追加）
- 新規投稿（記事や投稿データの追加）
- 商品登録（商品データの追加）

---
<!-- _class: title-top -->

## 8章 INSERT文の基本的な書き方

```sql
INSERT INTO テーブル名 (カラム名1, カラム名2, カラム名3)
VALUES (値1, 値2, 値3);
```

<div class="no-bg">

**ポイント**

</div>

- `INTO`（〜の中に）のあとに追加先のテーブル名と追加対象のカラム名
- `VALUES`（値）のあとに追加する値を記述
- **追加対象のカラム名と追加する値は順番どおりに書く**
- 例：カラム名を `(id, name, age)` にしたら、値も同じ順番で `(1, '侍太郎', 36)`

---
<!-- _class: title-top -->

## 8章 UPDATE文とは

<div class="no-bg">

**UPDATE文は、テーブル内のデータを更新するSQL命令です。**

</div>

- UPDATEは「更新する」という意味
- テーブルに対して「○○というデータを更新してください」と命令
- アプリやサービスではユーザーの住所変更や投稿内容の編集など、データを更新する際に使う

**主な用途**
- ユーザー情報の変更（住所、メールアドレスなど）
- 投稿内容の編集
- 商品情報の更新（価格、在庫数など）

---
<!-- _class: title-top -->

## 8章 UPDATE文の基本的な書き方

```sql
UPDATE テーブル名
SET カラム名1 = 値1, カラム名2 = 値2
WHERE 条件式;
```

<div class="no-bg">

**ポイント**

</div>

- `UPDATE`のあとにテーブル名
- `SET`（セットする）のあとに更新するカラム名とその値
- `WHERE`（どこに）のあとに「どのデータを更新するか」を判定する条件式
- **WHERE句を忘れると、テーブル内のすべてのデータが更新されてしまう**

---
<!-- _class: title-top -->

## 8章 まとめ

### データの追加

```sql
INSERT INTO テーブル名 (カラム名1, カラム名2, カラム名3)
VALUES (値1, 値2, 値3);
```

### データの更新

```sql
UPDATE テーブル名
SET カラム名1 = 値1, カラム名2 = 値2
WHERE 条件式;
```
---

<!-- _class: title -->

# 9章 データを削除しよう

---

<!-- _class: title-top -->

## 9章 データを削除しよう

SQLによるデータ操作のうち、削除について学びます。

### 本章の目標

- SQLでテーブル内のデータを削除する方法を知ること

---

<!-- _class: title-top -->

## 9章 データ削除の必要性

<div class="no-bg">

**前章まで、テーブル内のデータを検索したり、追加更新する方法を学びました。**

</div>

本章では、SQLによるデータ操作の基本である削除について学びます。

- Twitterのような投稿アプリを例にすると、「投稿一覧の表示」「新規投稿」「投稿の編集」に続いて、「投稿の削除」にあたる操作も必須
- アプリやサービスを開発するうえでは、データを削除する操作方法も覚える必要がある

-
---

<!-- _class: title-top -->

## 9章 DELETE文の書き方

DELETE文の基本的な書き方は以下のとおりです。

```sql
-- 条件式に当てはまるデータを検索し、削除する
DELETE FROM テーブル名 WHERE 条件式;
```

### 構文の説明

- **FROM**のあとにテーブル名を記述
- **WHERE**のあとに「どのデータを削除するか」を判定するための条件式を記述
- 基本的には削除したいデータの**id**を指定する



---

<!-- _class: title-top -->

## 9章 まとめ

```sql
-- 条件式に当てはまるデータを検索し、削除する
DELETE FROM テーブル名 WHERE 条件式;
```

### 重要なポイント

- **DELETE文**でテーブル内のデータを削除
- **DROP文**ではなく、DELETE文を使う
- WHERE句で削除対象を指定（通常はidを指定）


---

<!-- _class: title -->

# 10章 特定のデータを検索しよう

---

<!-- _class: title-top -->

## 10章 特定のデータを検索しよう

SQLで特定のデータを検索する方法を学びます。

### 本章の目標

- SQLで特定のデータを検索する方法を知ること
- WHERE句の条件式に使える演算子を知ること

---

<!-- _class: title-top -->

## 10章 条件を絞った検索の必要性

<div class="no-bg">

**前章ではSQLのSELECT文を使い、指定したカラムのデータを取得する方法を学びました。**

</div>

実際のアプリやサービスでは、条件を絞ってデータを検索したい場面も出てきます。

- 「住所が東京都のユーザー」
- 「年齢が20歳未満の男性」

そこで使うのが**WHERE句**と**演算子**です。

<div class="no-bg">

**演算子＝プログラミング言語やデータベース言語において、計算や比較に使われる記号のこと**

</div>

---

<!-- _class: title-top -->

## 10章 WHERE句で特定のデータを検索しよう

<div class="no-bg">

### **WHEREは「どこに」という意味で、条件を指定してテーブル内の特定のデータを検索するコマンドです。**

</div>

前章で学んだSQLの基本的な構文（SELECT、UPDATE、DELETE）と組み合わせて使います。

```sql
SELECT * FROM users WHERE address = '東京都';
```

addressカラムに「東京都」という値を持つレコードのみを検索して取得できます。


---

<!-- _class: title-top -->

## 10章 WHERE句の書き方

WHERE句の基本的な書き方は以下のとおりです。

```sql
-- 条件式に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE 条件式;

-- 条件式に当てはまるデータを検索し、セットされた値で更新する
UPDATE テーブル名 SET カラム名1 = 値1, カラム名2 = 値2
WHERE 条件式;

-- 条件式に当てはまるデータを検索し、削除する
DELETE FROM テーブル名 WHERE 条件式;
```

---

<!-- _class: title-top -->

## 10章 WHERE句を実行してみよう

addressカラムの値が「神奈川県」のレコードを取得してみます。

```sql
SELECT * FROM users WHERE address = '神奈川県';
```

### 実行結果

- SELECTのあとに「すべてのカラム」を表す*（アスタリスク）を指定
- address = 神奈川県に一致するレコードのすべてのカラムを取得
- usersテーブルには住所が神奈川県のユーザーが3人存在

---

<!-- _class: title-top -->

## 10章 WHERE句の条件式に使える演算子を知ろう

<div class="no-bg">

### **演算子＝プログラミング言語やデータベース言語において、計算や比較に使われる記号のこと**

</div>

WHERE句でよく使われる演算子は主に以下の2種類です。

### 比較演算子

2つの値を比較し、その結果をTRUEまたはFALSEで返す演算子

### 論理演算子

複数の条件式を組み合わせて「AかつB」「AまたはB」といった演算を行う演算子

---

<!-- _class: title-top -->

## 10章 比較演算子

比較演算子は>や<=など、2つの値を比較し、その結果をTRUEまたはFALSEで返す演算子です。

| 比較演算子 | 使用例 | 意味 |
|-----------|-------|------|
| = | A = B | AとBが等しいとき、TRUEを返す |
| != | A != B | AとBが等しくないとき、TRUEを返す |
| < | A < B | AがBよりも小さいとき、TRUEを返す |
| <= | A <= B | AがB以下のとき、TRUEを返す |
| > | A > B | AがBよりも大きいとき、TRUEを返す |
| >= | A >= B | AがB以上のとき、TRUEを返す |

---

<!-- _class: title-top -->

## 10章 比較演算子（続き）

| 比較演算子 | 使用例 | 意味 |
|-----------|-------|------|
| IS NULL | A IS NULL | AがNULLのとき、TRUEを返す |
| IS NOT NULL | A IS NOT NULL | AがNULLでないとき、TRUEを返す |


</div>

---

<!-- _class: title-top -->

## 10章 論理演算子

論理演算子は**AND**や**OR**など、複数の条件式を組み合わせて「AかつB」「AまたはB」といった演算を行う演算子です。

```sql
WHERE age > 30 AND address = '東京都'
```

「年齢が30より大きく、かつ住所が東京都である」という条件に一致するユーザーデータを検索

| 論理演算子 | 使用例 | 意味 |
|-----------|-------|------|
| AND | A AND B | AとBがいずれもTRUEのとき、TRUEを返す |
| && | A && B | AとBがいずれもTRUEのとき、TRUEを返す |
| OR | A OR B | AかBの少なくとも1つがTRUEのとき、TRUEを返す |

---

<!-- _class: title-top -->

## 10章 論理演算子（続き）

| 論理演算子 | 使用例 | 意味 |
|-----------|-------|------|
| \|\| | A \|\| B | AかBの少なくとも1つがTRUEのとき、TRUEを返す |
| XOR | A XOR B | AかBのどちらか1つがTRUEのとき、TRUEを返す |
| NOT | NOT A | AがFALSEのとき、TRUEを返す |
| ! | !A | AがFALSEのとき、TRUEを返す |

---

<!-- _class: title-top -->

## 10章 比較演算子を使ってみよう

WHERE句で比較演算子を使い、「年齢が30歳以下」という条件でデータを検索してみましょう。

```sql
SELECT * FROM users WHERE age <= 30;
```

### 実行結果

- usersテーブルには年齢が30歳以下のユーザーが4人存在
- **<=**（以下）という比較演算子を使って条件を指定

---

<!-- _class: title-top -->

## 10章 論理演算子を使ってみよう

WHERE句で論理演算子を使い、「年齢が30歳以上」**かつ**「住所が神奈川県」という条件でデータを検索してみましょう。

```sql
SELECT * FROM users WHERE age >= 30 AND address = '神奈川県';
```

### 実行結果

- usersテーブルには「年齢が30歳以上」かつ「住所が神奈川県」のユーザーが2人存在
- **AND**という論理演算子で複数の条件を組み合わせた

---

<!-- _class: title-top -->

## 10章 まとめ（1/3）

### 基本構文

```sql
-- 条件式に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE 条件式;

-- 条件式に当てはまるデータを検索し、セットされた値で更新する
UPDATE テーブル名 SET カラム名1 = 値1, カラム名2 = 値2 WHERE 条件式;

-- 条件式に当てはまるデータを検索し、削除する
DELETE FROM テーブル名 WHERE 条件式;
```

---

<!-- _class: title-top -->

## 10章 まとめ（2/3）

### 比較演算子

| 演算子 | 使用例 | 意味 |
|-------|-------|------|
| = | A = B | AとBが等しいとき、TRUEを返す |
| != | A != B | AとBが等しくないとき、TRUEを返す |
| < | A < B | AがBよりも小さいとき、TRUEを返す |
| <= | A <= B | AがB以下のとき、TRUEを返す |
| > | A > B | AがBよりも大きいとき、TRUEを返す |
| >= | A >= B | AがB以上のとき、TRUEを返す |
| IS NULL | A IS NULL | AがNULLのとき、TRUEを返す |
| IS NOT NULL | A IS NOT NULL | AがNULLでないとき、TRUEを返す |

---

<!-- _class: title-top -->

## 10章 まとめ（3/3）

### 論理演算子

| 演算子 | 使用例 | 意味 |
|-------|-------|------|
| AND | A AND B | AとBがいずれもTRUEのとき、TRUEを返す |
| && | A && B | AとBがいずれもTRUEのとき、TRUEを返す |
| OR | A OR B | AかBの少なくとも1つがTRUEのとき、TRUEを返す |
| \|\| | A \|\| B | AかBの少なくとも1つがTRUEのとき、TRUEを返す |
| XOR | A XOR B | AかBのどちらか1つがTRUEのとき、TRUEを返す |
| NOT | NOT A | AがFALSEのとき、TRUEを返す |
| ! | !A | AがFALSEのとき、TRUEを返す |



---

<!-- _class: title -->

# 11章 より複雑なデータを検索しよう

---

<!-- _class: title-top -->

## 11章 より複雑なデータを検索しよう

WHERE句を使ったより複雑な条件で特定のデータを検索する方法を学びます。

### 本章の目標

- AND演算子とOR演算子で複数の条件を指定する方法を知ること
- 指定範囲のデータを抽出する方法を知ること
- 複数の値のうちいずれかに一致するデータの抽出方法を知ること
- 文字列のあいまい検索（「〜を含む」など）を行う方法を知ること

---

<!-- _class: title-top -->

## 11章 より複雑な検索の必要性

<div class="no-bg">

**前章ではWHERE address = '神奈川県'（住所が神奈川県）やWHERE age <= 30（年齢が30歳以下）など、WHERE句を使って特定のデータを検索しました。**

</div>

しかし実際のアプリやサービスでは、より複雑な条件で検索することが多いです。

- 「商品価格が3000〜5000円」
- 「商品名に『紅茶』を含む」

そこで、本章では前章に引き続きWHERE句を使い、より複雑な条件で特定のデータを検索する方法を学びます。

---

<!-- _class: title-top -->

## 11章 WHERE句について復習しよう

WHERE句は、SQLの基本的な構文（SELECT、UPDATE、DELETE）と組み合わせて使います。

```sql
-- 条件式に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE 条件式;

-- 条件式に当てはまるデータを検索し、セットされた値で更新する
UPDATE テーブル名 SET カラム名1 = 値1, カラム名2 = 値2 WHERE 条件式;

-- 条件式に当てはまるデータを検索し、削除する
DELETE FROM テーブル名 WHERE 条件式;
```

---

<!-- _class: title-top -->

## 11章 演算子について復習しよう

WHERE句でよく使われる演算子は主に以下の2種類です。

### 比較演算子

2つの値を比較し、その結果をTRUEまたはFALSEで返す演算子

- `>` `<=` `=` `!=` など

### 論理演算子

複数の条件式を組み合わせて「AかつB」「AまたはB」といった演算を行う演算子

- `AND` `OR` など

---

<!-- _class: title-top -->

## 11章 比較演算子の復習

| 比較演算子 | 使用例 | 意味 |
|-----------|-------|------|
| = | A = B | AとBが等しいとき、TRUEを返す |
| != | A != B | AとBが等しくないとき、TRUEを返す |
| < | A < B | AがBよりも小さいとき、TRUEを返す |
| <= | A <= B | AがB以下のとき、TRUEを返す |
| > | A > B | AがBよりも大きいとき、TRUEを返す |
| >= | A >= B | AがB以上のとき、TRUEを返す |
| IS NULL | A IS NULL | AがNULLのとき、TRUEを返す |
| IS NOT NULL | A IS NOT NULL | AがNULLでないとき、TRUEを返す |

---

<!-- _class: title-top -->

## 11章 論理演算子の復習

| 論理演算子 | 使用例 | 意味 |
|-----------|-------|------|
| AND | A AND B | AとBがいずれもTRUEのとき、TRUEを返す |
| && | A && B | AとBがいずれもTRUEのとき、TRUEを返す |
| OR | A OR B | AかBの少なくとも1つがTRUEのとき、TRUEを返す |
| \|\| | A \|\| B | AかBの少なくとも1つがTRUEのとき、TRUEを返す |
| XOR | A XOR B | AかBのどちらか1つがTRUEのとき、TRUEを返す |
| NOT | NOT A | AがFALSEのとき、TRUEを返す |
| ! | !A | AがFALSEのとき、TRUEを返す |

---

<!-- _class: title-top -->

## 11章 AND演算子とOR演算子で複数の条件を指定しよう

<div class="no-bg">

**アプリやサービスでは「高度な検索」や「詳細検索」など、複数の条件を指定して検索したい場面が出てきます。**

</div>

例：「言語が日本語かつ『SQL』というワードを含む」投稿を検索する

そこでよく使うのが、SQLのAND演算子とOR演算子です。

```sql
SELECT * FROM users WHERE age >= 30 AND address = '神奈川県';
```

---

<!-- _class: title-top -->

## 11章 AND演算子とOR演算子の書き方

基本的な書き方は以下のとおりです。

```sql
-- 「AかつB」という条件に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE A AND B;

-- 「AまたはB」という条件に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE A OR B;

-- 「Aかつ『BまたはC』」という条件に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE A AND (B OR C);
```

---

<!-- _class: title-top -->

## 11章 評価の優先順位

<div class="no-bg">

**普通の計算と同じようにSQLでも丸括弧()をつけると優先順位が高くなります。**

</div>

`A AND (B OR C)`という式の評価順序：

1. `B OR C`を評価する
   - TRUEだった場合 → 2に進む
   - FALSEだった場合 → `A AND FALSE`となり、FALSEを返す

2. `A`を評価する
   - TRUEだった場合 → `TRUE AND TRUE`となり、TRUEを返す
   - FALSEだった場合 → `FALSE AND TRUE`となり、FALSEを返す

---

<!-- _class: title-top -->

## 11章 AND演算子とOR演算子を使ってみよう

「年齢が30歳以上かつ『住所が神奈川県または大阪府』」という条件を指定してみます。

```sql
SELECT * FROM users 
WHERE age >= 30 AND (address = '神奈川県' OR address = '大阪府');
```

### 実行結果

usersテーブルには「年齢が30歳以上かつ『住所が神奈川県または大阪府』」のユーザーが4人いることがわかります。

---

<!-- _class: title-top -->

## 11章 BETWEEN句で指定範囲のデータを抽出しよう

<div class="no-bg">

**アプリやサービスでは3000〜5000円の商品を検索するときなど、下限値と上限値を指定して検索したい場合があります。**

</div>

そこでよく使うのが、SQLのBETWEEN句です。

**BETWEEN**は「（2つの）間で」という意味で、カラムの値が下限値以上、上限値以下の場合にTRUEを返すコマンドです。

例：`WHERE price BETWEEN 3000 AND 5000`

---

<!-- _class: title-top -->

## 11章 BETWEEN句の書き方

BETWEEN句の基本的な書き方は以下のとおりです。

```sql
-- カラムの値が下限値以上、上限値以下のデータを抽出する
SELECT カラム名 FROM テーブル名 WHERE カラム名 BETWEEN 下限値 AND 上限値;
```

### 注意点

- BETWEEN句は比較演算子の一種
- 本教材では「BETWEEN句」という呼び方で統一

---

<!-- _class: title-top -->

## 11章 BETWEEN句を使ってみよう

「年齢が30歳以上、40歳以下」という条件を指定してみます。

```sql
SELECT * FROM users WHERE age BETWEEN 30 AND 40;
```

### 実行結果

usersテーブルには「年齢が30歳以上、40歳以下」のユーザーが7人いることがわかります。

---

<!-- _class: title-top -->

## 11章 IN句で複数の値から一致するデータを抽出しよう

30歳、40歳、50歳、60歳のユーザーデータを取得したいとき...

<div class="no-bg">

**`WHERE age = 30 OR age = 40 OR age = 50 OR age = 60`と書いてもよいのですが、これでは書くのが大変なうえ、読みにくくなってしまいます。**

</div>

このように複数の値のうち、いずれかに一致するデータを抽出したいときは、IN句を使えば簡単です。

`WHERE age IN (30, 40, 50, 60)`のようにリスト形式で簡潔に記述できます。

---

<!-- _class: title-top -->

## 11章 IN句とOR演算子の比較

| IN句の有無 | WHERE句の書き方（一例） |
|-----------|---------------------|
| IN句なし | WHERE age = 30 OR age = 40 OR age = 50 OR age = 60 |
| IN句あり | WHERE age IN (30, 40, 50, 60) |

<div class="no-bg">

**IN**は「〜の中に」という意味で、複数の値のうちいずれかに一致するデータを抽出するコマンドです。

</div>

---

<!-- _class: title-top -->

## 11章 IN句の書き方

IN句の基本的な書き方は以下のとおりです。

```sql
-- カラムの値がリスト（複数の値）のうちいずれかに一致するデータを抽出する
SELECT カラム名 FROM テーブル名 WHERE カラム名 IN (値1, 値2, ......);
```

### IN句の強み

- 値をカンマで区切ってリスト形式で記述
- BETWEEN句のように連続した値でなくてもよい

---

<!-- _class: title-top -->

## 11章 IN句を使ってみよう

年齢を5歳から75歳まで、10刻みでリストを作ってみます。

```sql
SELECT * FROM users WHERE age IN (5, 15, 25, 35, 45, 55, 65, 75);
```

### 実行結果

usersテーブルには「35歳、55歳、65歳、75歳」のユーザーが1人ずついることがわかります。

このように、IN句を使えば複数の値のうちいずれかに一致するデータを抽出できます。

---

<!-- _class: title-top -->

## 11章 LIKE句で文字列のあいまい検索をしよう

`WHERE furigana = 'たろう'`と記述すれば、ふりがなが「たろう」と「完全に一致する」データは検索できます。

しかし、「たろう」を「含む」データや「たろう」で「終わる」データなど、あいまいな検索はできません。

そこで使うのがLIKE句です。

<div class="no-bg">

**LIKE**は「〜のような」という意味で、その文字列を「含む」データやその文字列で「始まる」「終わる」データなど、あいまい検索を行うコマンドです。

</div>

---

<!-- _class: title-top -->

## 11章 LIKE句の使い方

例：`WHERE furigana LIKE '%たろう%'`と記述すれば、ふりがなに「たろう」を「含む」データを検索できます。

比較演算子の`=`を`LIKE`に置き換えて「『たろう』のような」とあいまいにするイメージです。

### 活用場面

アプリやサービスで商品名や投稿などの検索機能を作るときは、このLIKE句が使われることが多いです。

---

<!-- _class: title-top -->

## 11章 LIKE句の書き方

LIKE句の基本的な書き方は以下のとおりです。

```sql
-- 指定した文字列であいまい検索を行い、一致するデータを取得する
SELECT カラム名 FROM テーブル名 WHERE カラム名 LIKE '検索文字列';
```

### ワイルドカードとは

<div class="no-bg">

**トランプにおけるジョーカーのような存在で、`%`や`_`のように1つの文字だけであらゆる文字を表せる特殊文字のことです。**

</div>

---

<!-- _class: title-top -->

## 11章 LIKE句で使えるワイルドカード

| ワイルドカード文字 | 意味 |
|-----------------|------|
| % | 0文字以上の任意の文字列 |
| _ | 任意の1文字 |

### 例

- `'%たろう'`：「しょうたろう」「いちたろう」「こたろう」「たろう」のように、「たろう」の前に何文字あっても検索条件にマッチ
- `'_たろう'`：「こたろう」「きたろう」のように、「たろう」の前に1文字ある場合しか検索条件にマッチしない

---

<!-- _class: title-top -->

## 11章 LIKE句を使った代表的な検索方法

| 検索方法 | 書き方 | 例 |
|---------|-------|-----|
| 完全一致 | '文字列' | 'さむらい たろう'<br/>（「さむらい たろう」と完全に一致するデータを検索する） |
| 前方一致 | '文字列%' | 'さむらい%'<br/>（「さむらい」で始まるデータを検索する） |
| 後方一致 | '%文字列' | '%たろう'<br/>（「たろう」で終わるデータを検索する） |
| 部分一致 | '%文字列%' | '%むらい%'<br/>（「むらい」を含むデータを検索する） |

---

<!-- _class: title-top -->

## 11章 LIKE句を使ってみよう

氏名に「八」を含むデータを検索してみます。

```sql
SELECT * FROM users WHERE name LIKE '%八%';
```

### 実行結果

usersテーブルには氏名に「八」を含むユーザーが1人いることがわかります。

---

<!-- _class: title-top -->

## 11章 演習

### 演習の内容

1. データベースとテーブルを作成する
2. WHERE句でデータを検索する
   - 「年齢が50歳以下」かつ「住所が埼玉県」という条件で検索
3. IN句でデータを検索する
   - 「住所が九州の7県（福岡県、佐賀県、長崎県、熊本県、大分県、宮崎県、鹿児島県）」という条件で検索

---

<!-- _class: title-top -->

## 11章 演習の解答例（1/2）

### WHERE句でデータを検索

```sql
-- 「年齢が50歳以下」かつ「住所が埼玉県」のデータを検索
SELECT * FROM users WHERE age <= 50 AND address = '埼玉県';
```

### 解説

<div class="no-bg">

**「AかつB」という複数の条件に当てはまるデータを検索する場合、AND演算子を使います。**

</div>

---

<!-- _class: title-top -->

## 11章 演習の解答例（2/2）

### IN句でデータを検索

```sql
-- 「住所が九州の7県」のデータを検索
SELECT * FROM users 
WHERE address IN ('福岡県', '佐賀県', '長崎県', '熊本県', 
                  '大分県', '宮崎県', '鹿児島県');
```

### 解説

複数の値のうち、いずれかに一致するデータを抽出するには、IN句を使います。

---

<!-- _class: title-top -->

## 11章 まとめ（1/3）

- 普通の計算と同じように、SQLでも丸括弧()をつけると評価の優先順位が高くなる
- **BETWEEN**は「（2つの）間で」という意味で、カラムの値が下限値以上、上限値以下の場合にTRUEを返すコマンド
- **IN**は「〜の中に」という意味で、複数の値のうちいずれかに一致するデータを抽出するコマンド

---

<!-- _class: title-top -->

## 11章 まとめ（2/3）

- **LIKE**は「〜のような」という意味で、その文字列を「含む」データやその文字列で「始まる」「終わる」データなど、あいまい検索を行うコマンド
- **ワイルドカード**とは、`%`や`_`のように1つの文字だけであらゆる文字を表せる特殊文字のこと

| ワイルドカード文字 | 意味 |
|-----------------|------|
| % | 0文字以上の任意の文字列 |
| _ | 任意の1文字 |

---

<!-- _class: title-top -->

## 11章 まとめ（3/3）

```sql
-- 「AかつB」という条件に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE A AND B;

-- 「AまたはB」という条件に当てはまるデータを検索し、取得する
SELECT カラム名 FROM テーブル名 WHERE A OR B;

-- カラムの値が下限値以上、上限値以下のデータを抽出する
SELECT カラム名 FROM テーブル名 WHERE カラム名 BETWEEN 下限値 AND 上限値;

-- カラムの値がリスト（複数の値）のうちいずれかに一致するデータを抽出する
SELECT カラム名 FROM テーブル名 WHERE カラム名 IN (値1, 値2, ......);

-- 指定した文字列であいまい検索を行い、一致するデータを取得する
SELECT カラム名 FROM テーブル名 WHERE カラム名 LIKE '検索文字列';
```


---

<!-- _class: title -->

# 12章 取得するデータ数の上限を設定しよう

---

<!-- _class: title-top -->

## 12章 取得するデータ数の上限を設定しよう

SQLで取得するデータ数の上限を設定する方法を学びます。

### 本章の目標

- SQLで取得するデータ数の上限を設定する方法を知ること

---

<!-- _class: title-top -->

## 12章 データ数の上限設定の必要性

<div class="no-bg">

**これまでは取得するデータ数の上限を特に設定せず、条件に当てはまるデータをすべて取得してきました。**

</div>

本章では、取得するデータ数の上限を設定する方法を学びましょう。

---

<!-- _class: title-top -->

## 12章 LIMIT句で取得するデータ数の上限を設定しよう

<div class="no-bg">

**アプリやサービスでは、例えば「1ページあたり10件だけデータを表示したい」というように、指定した数だけデータを取得したい場面が出てきます。**

</div>

そこでよく使うのが、SQLのLIMIT句です。

**LIMIT**は「制限する、限定する」という意味で、取得するデータ数の上限を設定するコマンドです。

例：`LIMIT 10`のように上限を指定すれば、取得するデータ数が最大でも10件になります。

---

<!-- _class: title-top -->

## 12章 LIMIT句の書き方

LIMIT句の基本的な書き方は以下のとおりです。

```sql
-- 指定した最大件数までのデータを取得する
SELECT カラム名 FROM テーブル名 LIMIT 最大件数;
```

### 注意点

- LIMIT句はSELECT文と組み合わせて使用
- 取得するデータの最大件数を制限

---

<!-- _class: title-top -->

## 12章 LIMIT句を使ってみよう

最大件数を10件に指定して、すべてのカラムのデータを取得してみます。

```sql
SELECT * FROM users LIMIT 10;
```

### 実行結果

LIMIT句に指定した10件のデータが取得されていることがわかります。

---

<!-- _class: title-top -->

## 12章 まとめ

<div class="no-bg">

**LIMIT**は「制限する、限定する」という意味で、取得するデータ数の上限を設定するコマンドです。

</div>

```sql
-- 指定した最大件数までのデータを取得する
SELECT カラム名 FROM テーブル名 LIMIT 最大件数;
```

### 活用場面

- ページネーション（1ページあたりの表示件数を制限）
- ランキング表示（上位N件のみ表示）
- サンプルデータの取得（一部のデータのみ確認）


---

<!-- _class: title -->

# 13章 取得するデータを並び替えよう

---

<!-- _class: title-top -->

## 13章 取得するデータを並び替えよう

SQLで取得するデータを並び替える方法を学びます。

### 本章の目標

- SQLで取得するデータを並び替える方法を知ること
- カラムを2つ指定して並び替えてみること
- WHERE句と組み合わせて特定のデータを並び替えてみること

---

<!-- _class: title-top -->

## 13章 データの並び替えの必要性

<div class="no-bg">

**これまでSQLのSELECT文を使ってさまざまな方法でデータを取得してきましたが、その順番は順不同でした。**

</div>

**順不同**＝一定の基準に基づいた並び順になっていないこと

しかし、アプリやサービスでは並び替え機能をはじめとして、取得するデータの並び順をしっかりと決めたい場面がたくさん出てきます。

---

<!-- _class: title-top -->

## 13章 ORDER BY句で取得するデータを並び替えよう

<div class="no-bg">

**アプリやサービスでは、例えば「価格が安い順に並び替える」「投稿日が新しい順に並び替える」など、並び替え機能を作成したい場面が出てきます。**

</div>

そこで使うのが、SQLのORDER BY句です。

**ORDER BY**は「〜によって順序づける」という意味で、特定のカラムを昇順（ASC）または降順（DESC）で並び替えるコマンドです。

---

<!-- _class: title-top -->

## 13章 ASCとDESCについて

### ASC（昇順）

**ASC**＝「上昇する（形容詞）」を意味するascendingの略。ascending orderで「昇順」を意味する

- 小さい数 → 大きい数
- A → Z、あ → ん
- 古い日時 → 新しい日時

### DESC（降順）

**DESC**＝「下降する（形容詞）」を意味するdescendingの略。descending orderで「降順」を意味する

- 大きい数 → 小さい数
- Z → A、ん → あ
- 新しい日時 → 古い日時

---

<!-- _class: title-top -->

## 13章 ORDER BY句の書き方

ORDER BY句の基本的な書き方は以下のとおりです。

```sql
-- 特定のカラムを昇順（ASC）または降順（DESC）で並び替え、その順番でデータを取得する
SELECT 取得するカラム名 FROM テーブル名 ORDER BY 並び替えるカラム名 並べ方;
```

### 注意点

- 「並べ方」の部分にはASC（昇順）またはDESC（降順）を指定
- ORDER BY句で並べ方を指定しない場合は初期値のASCが適用される

例：`ORDER BY age DESC`と指定すれば、年齢が高い順（降順）に並べ替えられる

---

<!-- _class: title-top -->

## 13章 ORDER BY句を使ってみよう（昇順）

年齢が低い順（昇順）にデータを並び替えてみます。

```sql
SELECT * FROM users ORDER BY age ASC;
```

### 実行結果

指定したとおり年齢が低い順（昇順）にデータが並び替えられていることがわかります。

---

<!-- _class: title-top -->

## 13章 ORDER BY句を使ってみよう（降順）

年齢が高い順（降順）にデータを並び替えてみます。

```sql
SELECT * FROM users ORDER BY age DESC;
```

### 実行結果

指定したとおり年齢が高い順（降順）にデータが並び替えられていることがわかります。

---

<!-- _class: title-top -->

## 13章 カラムを2つ指定して並び替えてみよう

<div class="no-bg">

**ORDER BY句にはカラムを複数指定することもできます。**

</div>

```sql
-- 複数のカラムを昇順（ASC）または降順（DESC）で並び替え、その順番でデータを取得する
SELECT 取得するカラム名 FROM テーブル名 
ORDER BY 並び替えるカラム名1 並べ方, 並び替えるカラム名2 並べ方, ……;
```

### ポイント

複数のカラムを指定する場合はカンマ区切りで記述し、ORDER BY句に近い左側のカラムから順番に並び替えられます。

---

<!-- _class: title-top -->

## 13章 複数カラムでの並び替えの例

`ORDER BY age DESC, furigana ASC;`と指定した場合：

1. まず、年齢が高い順（降順）に並び替えられる
2. 次に、（同じ年齢のデータが複数ある場合に限り）ふりがなが五十音順（昇順）に並び替えられる

```sql
SELECT * FROM users ORDER BY age DESC, furigana ASC;
```
#### 実行結果を見ると、先に年齢が高い順（降順）に並び替えられたあと、（同じ年齢のデータが複数ある場合に限り）ふりがなが五十音順（昇順）に並び替えられていることがわかります。

---

<!-- _class: title-top -->

## 13章 WHERE句と組み合わせて特定のデータを並び替えてみよう

<div class="no-bg">

**ORDER BY句はWHERE句と組み合わせて使うことで、特定のデータを並び替えることもできます。**

</div>

```sql
-- 特定のカラムを昇順（ASC）または降順（DESC）で並び替え、その順番で特定のデータを取得する
SELECT カラム名 FROM テーブル名 WHERE 条件式 ORDER BY 並び替えるカラム名 並べ方;
```

これは、例えば「『紅茶』と検索して価格が安い順に並び替えたい」といった場面で役立ちます。

---

<!-- _class: title-top -->

## 13章 WHERE句とORDER BY句を組み合わせた例

30歳以上のユーザーデータを取得し、年齢が低い順（昇順）に並び替えてみます。

```sql
SELECT * FROM users WHERE age >= 30 ORDER BY age ASC;
```

### 実行結果

特定のデータ（30歳以上のユーザーデータ）の年齢が低い順（昇順）に並び替えられていることがわかります。

---

<!-- _class: title-top -->

## 13章 まとめ（1/2）

- **ORDER BY**は「〜によって順序づける」という意味で、特定のカラムを昇順（ASC）または降順（DESC）で並び替えるコマンド
- ORDER BY句にはカラムを複数指定することもできる。その場合、ORDER BY句に近い左側のカラムから順番に並び替えられる
- ORDER BY句とWHERE句を組み合わせることで、特定のデータを並び替えることができる

---

<!-- _class: title-top -->

## 13章 まとめ（2/2）

```sql
-- 特定のカラムを昇順（ASC）または降順（DESC）で並び替え、その順番でデータを取得する
SELECT 取得するカラム名 FROM テーブル名 ORDER BY 並び替えるカラム名 並べ方;

-- 複数のカラムを昇順（ASC）または降順（DESC）で並び替え、その順番でデータを取得する
SELECT 取得するカラム名 FROM テーブル名
ORDER BY 並び替えるカラム名1 並べ方, 並び替えるカラム名2 並べ方, ……;

-- 特定のカラムを昇順（ASC）または降順（DESC）で並び替え、その順番で特定のデータを取得する
SELECT カラム名 FROM テーブル名 WHERE 条件式 ORDER BY 並び替えるカラム名 並べ方;
```

---

<!-- _class: title -->

# 14章 関数を使ってデータを集計しよう

---

<!-- _class: title-top -->

## 14章 関数を使ってデータを集計しよう

SQLの関数を使ってレコード数やデータの合計値、平均値などを取得する方法を学びます。

### 本章の目標

- レコード数を取得する方法を知ること
- データの合計値を取得する方法を知ること
- データの平均値を取得する方法を知ること
- データの最大値と最小値を取得する方法を知ること

---

<!-- _class: title-top -->

## 14章 これまでの学習内容

<div class="no-bg">

**これまではSQLのSELECT文を使って単純にデータそのものを取得してきました。しかし、SQLの「集計関数」を使えば、データ数やデータの合計、平均、最大値、最小値などを取得できます。**

</div>

「1日あたりの売上や平均を知りたい」「月間のユーザー登録者数を知りたい」など、データを分析する場面ではとても役立つので、本章を進めてぜひ覚えておきましょう。

---

<!-- _class: title-top -->

## 14章 COUNT関数でレコード数を取得しよう

<div class="no-bg">

**アプリやサービスでは、例えば「都道府県別のユーザー数を知りたい」「全体のユーザー登録者数を知りたい」など、条件に一致するレコード数をカウントしたい場面が出てきます。**

</div>

そこで使うのが**COUNT関数**です。

**COUNT**は「数を数える」という意味で、条件に一致するレコード数を取得するSQLの関数です。

---

<!-- _class: title-top -->

## 14章 COUNT関数の使い方

COUNT関数の基本的な使い方は以下のとおりです。

```sql
-- テーブルのレコード数を取得する
SELECT COUNT(*) FROM テーブル名;
```

<div class="no-bg">

**これまではSELECTのあとに取得したいカラム名を指定していましたが、COUNT関数をはじめとする集計関数を使う場合、集計関数そのものを指定します。**

</div>

なお、集計関数の引数には集計対象のカラム名を指定するのですが、COUNT関数の場合は`*`（アスタリスク）を指定することが多いです。

---

<!-- _class: title-top -->

## 14章 COUNT関数の引数について

カラム名を指定した場合は、指定したカラムについて「NULL以外のレコードが何件あるか」をカウントできます。この場合、NULLが保存されているレコードはカウントされません。

そのため、「COUNT(*)でカウントしたら100件取得できたのに、COUNT(address)を指定したら98件しか取得できなかった」ということもありえます。この例では、指定したカラム（address）に2件のNULLが存在することを意味します。

### まとめ

- **COUNT(\*)**：NULLかどうかにかかわらず、すべてのレコード数を取得する
- **COUNT(カラム名)**：NULLを除いたレコード数を取得する

---

<!-- _class: title-top -->

## 14章 COUNT関数を使ってみよう

### では実際に、COUNT関数を使ってみましょう。今回はusersテーブルのレコード数を取得してみます。

```sql
SELECT COUNT(*) FROM users;
```

### 実行結果

### SQL文の実行結果を見ると、usersテーブルのレコード数が30件であることがわかります。

![SQL文の実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/55bb130e-1d16-4997-974c-3b19185fef08)

---

<!-- _class: title-top -->

## 14章 SUM関数で合計値を取得しよう

<div class="no-bg">

**アプリやサービスでは、例えば「1日あたりの売上を知りたい」「ユーザー1人あたりの課金額を知りたい」など、データの合計値を取得したい場面が出てきます。**

</div>

そこで使うのが**SUM関数**です。

**SUM**は「〜を合計する」という意味で、指定したカラムの合計値を取得するSQLの関数です。

---

<!-- _class: title-top -->

## 14章 SUM関数の使い方

SUM関数の基本的な使い方は以下のとおりです。

```sql
-- 指定したカラムの合計値を取得する
SELECT SUM(カラム名) FROM テーブル名;
```

---

<!-- _class: title-top -->

## 14章 SUM関数を使ってみよう

### では実際に、SUM関数を使ってみましょう。今回はusersテーブルのageカラムを指定して、ユーザーの総年齢を取得してみます。

```sql
SELECT SUM(age) FROM users;
```

### 実行結果

SQL文の実行結果を見ると、ユーザーの総年齢が1468歳であることがわかります。

![SQL文の実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/a85a5d59-5f6e-4269-b725-e06f5deb1662)

---

<!-- _class: title-top -->

## 14章 AVG関数で平均値を取得しよう

<div class="no-bg">

**アプリやサービスでは、例えば「1日の平均売上を知りたい」「ユーザーの平均年齢を知りたい」など、データの平均値を取得したい場面が出てきます。**

</div>

そこで使うのが**AVG関数**です。

**AVG**は「〜の平均値を求める」を意味するaverageの略で、指定したカラムの平均値を取得するSQLの関数です。

---

<!-- _class: title-top -->

## 14章 AVG関数の使い方

AVG関数の基本的な使い方は以下のとおりです。

```sql
-- 指定したカラムの平均値を取得する
SELECT AVG(カラム名) FROM テーブル名;
```

---

<!-- _class: title-top -->

## 14章 AVG関数を使ってみよう

では実際に、AVG関数を使ってみましょう。今回はusersテーブルのageカラムを指定して、ユーザーの平均年齢を取得してみます。

```sql
SELECT AVG(age) FROM users;
```

### 実行結果

SQL文の実行結果を見ると、ユーザーの平均年齢が約49歳であることがわかります。

![SQL文の実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/511e8497-87c5-4142-861f-079cc2909ab5)

---

<!-- _class: title-top -->

## 14章 MAX関数とMIN関数で最大値と最小値を取得しよう

<div class="no-bg">

**アプリやサービスでは、例えば「最も売れた商品の個数を知りたい」「最年少のユーザーの年齢を知りたい」など、データの最大値や最小値を取得したい場面が出てきます。**

</div>

そこで使うのが**MAX関数**と**MIN関数**です。

- **MAX**：「最大の」を意味するmaximumの略
- **MIN**：「最小の」を意味するminimumの略

MAXは指定したカラムの最大値を取得するSQLの関数、MINは最小値を取得するSQLの関数です。

---

<!-- _class: title-top -->

## 14章 MAX関数とMIN関数の特徴

<div class="no-bg">

**なお、MAX関数とMIN関数は数値型のデータだけでなく、文字列型や日付型のデータの最大値や最小値も取得できます。**

</div>

文字列型のデータであれば7章で学んだ照合順序、日付型であれば日付の新旧（新＝大、旧＝小）で大小を判定します。

---

<!-- _class: title-top -->

## 14章 MAX関数とMIN関数の使い方

MAX関数とMIN関数の基本的な使い方は以下のとおりです。

```sql
-- 指定したカラムの最大値を取得する
SELECT MAX(カラム名) FROM テーブル名;

-- 指定したカラムの最小値を取得する
SELECT MIN(カラム名) FROM テーブル名;
```

---

<!-- _class: title-top -->

## 14章 MAX関数を使ってみよう

では実際に、MAX関数を使ってみましょう。MAX関数の引数にageカラムを指定して、最高齢のユーザーを取得してみます。

```sql
SELECT MAX(age) FROM users;
```

### 実行結果

SQL文の実行結果を見ると、ユーザーの最高齢が77歳であることがわかります。

![SQL文の実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/7c77331e-e6cf-4857-b6bf-c17025018a88)

---

<!-- _class: title-top -->

## 14章 MIN関数を使ってみよう

続いてMIN関数の引数にageカラムを指定して、最年少のユーザーを取得してみましょう。

```sql
SELECT MIN(age) FROM users;
```

### 実行結果

SQL文の実行結果を見ると、ユーザーの最年少が21歳であることがわかります。

![SQL文の実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/99100b92-0f21-4f69-b6d0-8956342ffafe)

---

<!-- _class: title-top -->

## 14章 まとめ（1/3）

- SQLの集計関数を使うことで、データそのものではなくデータ数やデータの合計、平均、最大値、最小値などを取得できる
- **COUNT関数**：テーブルのレコード数を取得する
- **SUM関数**：指定したカラムの合計値を取得する
- **AVG関数**：指定したカラムの平均値を取得する
- **MAX関数／MIN関数**：指定したカラムの最大値／最小値を取得する

---

<!-- _class: title-top -->

## 14章 まとめ（2/3）

- **COUNT**は「数を数える」という意味で、条件に一致するレコード数を取得するSQLの関数である
  - **COUNT(\*)**：NULLかどうかにかかわらず、すべてのレコード数を取得する
  - **COUNT(カラム名)**：NULLを除いたレコード数を取得する
- **SUM**は「〜を合計する」という意味で、指定したカラムの合計値を取得するSQLの関数である
- **AVG**は「〜の平均値を求める」を意味するaverageの略で、指定したカラムの平均値を取得するSQLの関数である
- **MAX**は「最大の」を意味するmaximumの略で、指定したカラムの最大値を取得するSQLの関数である
- **MIN**は「最小の」を意味するminimumの略で、指定したカラムの最小値を取得するSQLの関数である

---

<!-- _class: title-top -->

## 14章 まとめ（3/3）

```sql
-- テーブルのレコード数を取得する
SELECT COUNT(*) FROM テーブル名;

-- 指定したカラムの合計値を取得する
SELECT SUM(カラム名) FROM テーブル名;

-- 指定したカラムの平均値を取得する
SELECT AVG(カラム名) FROM テーブル名;

-- 指定したカラムの最大値を取得する
SELECT MAX(カラム名) FROM テーブル名;

-- 指定したカラムの最小値を取得する
SELECT MIN(カラム名) FROM テーブル名;
```

---

<!-- _class: title -->

# 15章 取得するデータをグループ化しよう

---

<!-- _class: title-top -->

## 15章 取得するデータをグループ化しよう

SQLで取得するデータをグループ化する方法を学びます。

### 本章の目標

- SQLで取得するデータをグループ化する方法を知ること
- グループ化したデータをさらに絞り込む方法を知ること

---

<!-- _class: title-top -->

## 15章 グループ化の必要性

<div class="no-bg">

**前章では集計関数を使い、データ数やデータの合計、平均、最大値、最小値を取得しました。
しかし実際のアプリやサービスでは、「『1日あたりの』売上や平均を知りたい」「『都道府県別の』ユーザー数を知りたい」など、特定のグループごとにデータを集計したい場面も多いです。**

</div>

そこで本章では、SQLで取得するデータをグループ化する方法を学びます。

---

<!-- _class: title-top -->

## 15章 GROUP BY句で取得するデータをグループ化しよう

<div class="no-bg">

**アプリやサービスでは、例えば「1日あたりの売上を知りたい」「都道府県別のユーザー数を知りたい」など、カラムの値が同じレコードをグループ化して集計したい場面が出てきます。**

</div>

そこで使うのが、SQLの**GROUP BY句**です。

**GROUP BY**は「〜によってグループ化する」という意味で、カラムの値が同じレコードをグループ化する（まとめる）コマンドです。

---

<!-- _class: title-top -->

## 15章 GROUP BY句の書き方

GROUP BY句の基本的な書き方は以下のとおりです。

```sql
-- 指定したカラムでグループ化する
SELECT カラム名 FROM テーブル名 GROUP BY カラム名1, カラム名2, ......;
```

<div class="no-bg">

**GROUP BYのあとにカラムを複数指定した場合は、値の組み合わせが同じレコードがグループ化されます。**

</div>

例えば`GROUP BY age, address`と指定した場合、年齢と住所がともに同じ値のユーザー（例：年齢が36歳で住所が東京都）がグループ化されるということです。

---

<!-- _class: title-top -->

## 15章 GROUP BY句を使ってみよう（1/2）

では実際に、GROUP BY句を使ってみましょう。今回は、前章で学んだCOUNT関数とGROUP BY句を組み合わせ、住所（都道府県）別のユーザー数を取得してみます。

```sql
SELECT COUNT(*) FROM users GROUP BY address;
```

### 実行結果

SQL文の実行結果を見ると、addressカラムの値でグループ化され、それぞれのレコード数が取得できています。しかし、addressカラムの値が表示されていないため、住所（都道府県）とユーザー数の対応関係がわかりません。

---

<!-- _class: title-top -->

## 15章 GROUP BY句を使ってみよう（2/2）

そこで、addressカラムの値も表示してみましょう。

以下のようにSELECTのあとにカラム名を指定することで、グループ化したカラムの値も表示することができます。

```sql
SELECT address, COUNT(*) FROM users GROUP BY address;
```

### 実行結果

SQL文の実行結果を見ると、住所（都道府県）別のユーザー数が一目瞭然です。

---

<!-- _class: title-top -->

## 15章 HAVING句で条件を指定し、グループ化したデータをさらに絞り込もう

先ほどはGROUP BY句を使ってaddressカラムの値でグループ化し、住所（都道府県）別のユーザー数を取得しました。

<div class="no-bg">

**しかし、例えば「神奈川県のユーザー数だけを知りたい」というように、グループ化したデータをさらに絞り込みたい場面も出てきます。**

</div>

そこで使うのが、SQLの**HAVING句**です。

**HAVING**は「〜を持っている」という意味で、GROUP BY句でグループ化したあとに指定した条件でデータを絞り込むコマンドです。

---

<!-- _class: title-top -->

## 15章 HAVING句の書き方

HAVING句の基本的な書き方は以下のとおりです。HAVING句は基本的にGROUP BY句とセットで使います。

```sql
-- グループ化したあとに指定した条件でデータを絞り込む
SELECT カラム名 FROM テーブル名
GROUP BY カラム名1, カラム名2, ......
HAVING 条件式;
```

---

<!-- _class: title-top -->

## 15章 HAVING句を使ってみよう

### では実際に、HAVING句を使ってみましょう。今回は先ほどと同じように住所（都道府県）別のユーザー数を取得したあと、HAVING句で神奈川県のデータに絞り込んでみます。

```sql
SELECT address, COUNT(*) FROM users
GROUP BY address
HAVING address = '神奈川県';
```

### 実行結果

SQL文の実行結果を見ると、住所（都道府県）が神奈川県のユーザー数のみに絞り込まれています。


---

<!-- _class: title-top -->

## 15章 まとめ（1/2）

- **GROUP BY**は「〜によってグループ化する」という意味で、カラムの値が同じレコードをグループ化する（まとめる）コマンドである
- **HAVING**は「〜を持っている」という意味で、GROUP BY句でグループ化したあとに指定した条件でデータを絞り込むコマンドである

---

<!-- _class: title-top -->

## 15章 まとめ（2/2）

```sql
-- 指定したカラムでグループ化する
SELECT カラム名 FROM テーブル名
GROUP BY カラム名1, カラム名2, ......;

-- グループ化したあとに指定した条件でデータを絞り込む
SELECT カラム名 FROM テーブル名
GROUP BY カラム名1, カラム名2, ......
HAVING 条件式;
```

---

<!-- _class: title -->

# 16章 2つのテーブルを結合しよう

---

<!-- _class: title-top -->

## 16章2つのテーブルを結合しよう

SQLで2つのテーブルを結合する方法と、結合の種類について学びます。

### 本章の目標

- テーブル結合とは何かを知ること
- SQLで複数のテーブルを結合する方法を知ること
- テーブル結合の種類を知ること

---

<!-- _class: title-top -->

## 16章テーブル結合の必要性

<div class="no-bg">

**これまではusersテーブルだけを使い、データベース操作を学んできました。しかし、実際のWebアプリケーションでは、複数のテーブルを連携させてデータを管理する場合もあります。**

</div>

本章では、SQLで2つのテーブルを結合する方法を学びます。

---

<!-- _class: title-top -->

## 16章テーブル結合とは何かを知ろう

<div class="no-bg">

**テーブル結合とは、データを取得する際に複数のテーブルを連携させることです。SELECT文と併用して必要なデータを効率的に抽出することができます。**

</div>

たとえば、社員テーブルemployeesと部署テーブルdepartmentsを考えてみましょう。

各社員はどこかの部署に所属するため、部署IDdep_idで社員と部署を紐づけます。

![紐づけ](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/5d4d2db2-9c4d-40b0-a0f9-fcb74c8c882e)

---

<!-- _class: title-top -->

## 16章テーブル結合の活用シーン

これまでのSELECT文では、1つのテーブルのデータしか取得しませんでした。

<div class="no-bg">

**しかし、社員がどの部署に所属しているかを把握したいなら、両テーブルを参照する必要があります。**

</div>

このようなケースで役立つテクニックが、テーブル結合です。

---

<!-- _class: title-top -->

## 16章JOIN句でテーブルを結合しよう

SQLでテーブルを結合するときには、SELECT文にJOIN句を組み合わせて使います。

<div class="no-bg">

**JOIN句は、複数テーブルのデータを結合して取得するためのキーワードです。**

</div>

ただし、元のテーブルの構造自体を変えるわけではありません。あくまでも、SELECT文でのデータ取得時に、複数テーブルを組み合わせる機能です。

まずは、JOIN句の基本的な使い方を学び、実際に使ってみましょう。

---

<!-- _class: title-top -->

## 16章JOIN句の使い方

SELECT文でJOIN句を使う場合の最も基本的な書き方は、次のとおりです。

```sql
SELECT カラム名 FROM テーブルA JOIN テーブルB ON 結合条件;
```

FROM句のテーブルAと、結合したいテーブルBをJOIN句でつなぎ、ON句に結合条件を書きます。

---

<!-- _class: title-top -->

## 16章ON句の書き方

ON句には、結合したい2テーブルを紐づけるカラムを指定します。

たとえば、「部署テーブルの部署IDid」と「社員テーブルの部署IDdep_id」を紐づける場合、以下のように指定します。

```sql
ON departments.id = employees.dep_id;
```

<div class="no-bg">

**複数テーブルの場合は、「テーブル名.カラム名」のようにテーブル名も明記しましょう。「id」のようにカラム名が同じケースでも区別できるためです。**

</div>

---

<!-- _class: title-top -->

## 16章JOIN句を使ってみよう

実際にJOIN句を使ってみましょう。本章では、社員テーブルと部署テーブルを作成して、JOIN句を実践で繰り返し使います。

![社員テーブルと部署テーブル](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/3c544cbf-fdd3-45ca-b6f3-3d69ae433783)

---

<!-- _class: title-top -->

## 16章テーブル結合を実行してみよう

では実際に、JOIN句を使ってみましょう。今回は、社員テーブルと部署テーブルを結合し、部署IDが一致したレコードのみを取得してみます。

```sql
SELECT * FROM employees JOIN departments
ON departments.id = employees.dep_id;
```

---

<!-- _class: title-top -->

## 16章結合結果の確認

中身を見ると、左側に社員テーブルの3カラム、右側に部署テーブルの2カラムが表示されています。

<div class="no-bg">

**このように、複数テーブルのカラムを1テーブルとして取得するのが結合です。**

</div>

![結合](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/b8d1ba9e-fc97-43c4-9c57-6e4b1d195221)

#### なお、結合条件を「部署IDが一致するもの」としたため、社員テーブルにしかない「1004」は除外されました。

---

<!-- _class: title-top -->

## 16章ほかのキーワードを併用する場合

#### これまでの章ではデータを検索するWHERE句、並び替えるORDER BY句、グループ化するGROUP BY句を学んできました。

<div class="no-bg">

**JOIN句は、これらのキーワードとの併用も可能です。**

</div>

併用する場合、JOIN句のテーブル結合が優先されます。

```sql
SELECT * FROM employees JOIN departments
ON departments.id = employees.dep_id
WHERE departments.dep_name = '技術部';
```

---

<!-- _class: title-top -->

## 16章JOIN句の種類を知っておこう

#### JOIN句には5種類あり、それぞれテーブルの結合方法が異なります。

| 種類 | 機能 |
|------|------|
| INNER JOIN（内部結合） | 両テーブルで合致するレコードのみを結合 |
| LEFT OUTER JOIN（左外部結合） | 左テーブル基準で結合 |
| RIGHT OUTER JOIN（右外部結合） | 右テーブル基準で結合 |
| FULL OUTER JOIN（完全外部結合） | 両テーブルをそれぞれ基準にして結合 |
| CROSS JOIN（交差結合） | 両テーブルのレコードを総当たりで結合 |

---

<!-- _class: title-top -->

## 16章INNER JOIN（内部結合）

<div class="no-bg">

**INNER JOIN（内部結合）は、両テーブルで合致するレコードのみを結合します。**

</div>

つまり、左テーブルと右テーブルの両テーブルに存在するレコードだけが出力されます。

![INNER JOIN](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/b81dd167-75b2-4309-a40e-c937e2b59815)

---

<!-- _class: title-top -->

## 16章INNER JOINを使ってみよう

下記SQL文を実行すると、社員テーブルにも部署テーブルにも存在するレコードだけが出力されます。

```sql
SELECT * FROM employees INNER JOIN departments
ON departments.id = employees.dep_id;
```

なお、単に「JOIN」と記述した場合はINNER JOIN扱いです。

内部結合は、2テーブル間の結びつきが強いケースで役に立ちます。

---

<!-- _class: title-top -->

## 16章OUTER JOIN（外部結合）

<div class="no-bg">

**OUTER JOIN（外部結合）は、「INNER JOINの外側」にあるレコードも含めたテーブル結合です。**

</div>

つまり、片方のテーブルにしかないレコードも出力対象となります。

OUTER JOINは、「どちらのテーブルを基準にするか」によってLEFT・RIGHT・FULLの3種類に分けられます。

---

<!-- _class: title-top -->

## 16章LEFT OUTER JOIN（左外部結合）

<div class="no-bg">

**LEFT OUTER JOIN（左外部結合）は、左テーブルを基準にしたテーブル結合です。**

</div>

つまり左テーブルの全レコードと、それらに紐づく右テーブルのデータが結合されます。

![LEFT OUTER JOIN](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/e5b7f7ab-1d70-41b6-a7f1-a5e6c046a948)

---

<!-- _class: title-top -->

## 16章LEFT OUTER JOINを使ってみよう

下記のSQL文において、左テーブルはemployees（社員テーブル）です。

```sql
SELECT * FROM employees LEFT OUTER JOIN departments
ON departments.id = employees.dep_id;
```

なお、LEFT OUTER JOINは、単にLEFT JOINと書いても構いません。

右テーブル（部署テーブル）に存在しないデータは、「NULL（データなし）」となります。

---

<!-- _class: title-top -->

## 16章RIGHT OUTER JOIN（右外部結合）

<div class="no-bg">

**RIGHT OUTER JOIN（右外部結合）は、右テーブルを基準にしたテーブル結合です。**

</div>

つまり右テーブルの全レコードと、それらに紐づく左テーブルのデータが結合されます。

![RIGHT OUTER JOIN](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/cf19106d-b98f-44be-8ac7-f9185498bb5f)

---

<!-- _class: title-top -->

## 16章RIGHT OUTER JOINを使ってみよう

下記のSQL文において、右テーブルはdepartments（部署テーブル）です。

```sql
SELECT * FROM employees RIGHT OUTER JOIN departments
ON departments.id = employees.dep_id;
```

なお、RIGHT OUTER JOINは、単にRIGHT JOINと書いても構いません。

LEFT OUTER JOINとは逆に、左テーブルに存在しないデータがNULLとなります。

---

<!-- _class: title-top -->

## 16章FULL OUTER JOIN（完全外部結合）

<div class="no-bg">

**FULL OUTER JOIN（完全外部結合）は、両テーブルを基準にしたテーブル結合です。**

</div>

つまり左テーブルの全レコードと、右テーブルの全レコードを条件に沿って結合します。

```sql
SELECT * FROM employees FULL OUTER JOIN departments
ON departments.id = employees.dep_id;
```

ただし、残念ながらMySQLはFULL OUTER JOINに対応していません。

---

<!-- _class: title-top -->

## 16章FULL OUTER JOINのイメージ

### FULL OUTER JOINは、LEFT・RIGHTのOUTER JOINを組み合わせたイメージです。

左テーブルにしかないレコードも、右テーブルにしかないレコードもすべて出力されます。ただし、片方のテーブルに存在しないデータはNULLとなります。

---

<!-- _class: title-top -->

## 16章FULL OUTER JOINのイメージ
![FULL OUTER JOIN](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/9eae4a25-d83b-4737-b2b1-735453a16751)

---

<!-- _class: title-top -->

## 16章CROSS JOIN（交差結合）

<div class="no-bg">

**CROSS JOIN（交差結合）は、両テーブルのレコードを総当たりで組み合わせるテーブル結合です。**

</div>

INNER JOINやOUTER JOINとは、毛色がまったく異なります。

![CROSS JOIN](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/be2baf20-76af-4e6c-a637-390a550ac110)

---

<!-- _class: title-top -->

## 16章CROSS JOINを使ってみよう

以下のように、ON句による結合条件は必要ありません。

```sql
SELECT * FROM employees CROSS JOIN departments;
```

4人の各社員に対して、企画部・技術部・営業部という部署テーブルのレコードが結合されています。

4レコードと3レコードの総当たりで、出力されるのは4×3=12レコードです。

---

<!-- _class: title-top -->

## 16章CROSS JOINの注意点

<div class="no-bg">

**ただし総当たりのため、出力されるレコード数が多くなりやすいことに注意しましょう。**

</div>

仮に100レコード×100レコードの総当たりだと、10,000レコードも出力されてしまいます。

CROSS JOINは、たとえば「重量」と「地域」で送料が変わる配送システムで役に立ちます。重量テーブルと地域テーブルの組み合わせを網羅して、各送料を一覧表示できます。

---

<!-- _class: title-top -->

## 16章演習

INNER JOINを使って2つのテーブルを結合し、書籍名とその著者名をリストアップしてください。

書籍テーブル（books）と著者テーブル（authors）を作成し、INNER JOINを使って結合してください。

### 期待する出力結果

| book_id | title | author_name |
|---------|-------|-------------|
| 1 | HTML入門 | 著者A |
| 2 | データベース基礎編 | 著者B |
| 3 | データベース応用編 | 著者B |

---

<!-- _class: title-top -->

## 16章演習の解答例

模範解答は以下のとおりです。

```sql
SELECT book_id, title, author_name
FROM books INNER JOIN authors
ON books.author_id = authors.author_id;
```

今回は、書籍がどの著者によって書かれたかを表示させるために、bookテーブルのauthor_idとauthorsテーブルのauthor_idを関連付けて結合します。

なお、「著者C」に紐づく書籍はbooksテーブルに存在しないため、表示されません。

---

<!-- _class: title-top -->

## 16章まとめ（1/3）

- **JOIN句**は、複数テーブルのデータを結合して取得するためのキーワード
  - ON句で結合条件を指定する
- WHERE句やORDER BY句、GROUP BY句よりも、JOIN句のテーブル結合が優先される
- **外部キー**は、ほかのテーブルにあるカラムを参照するカラムのこと
  - テーブル作成（CREATE TABLE）の実行時に外部キーを設定できる

```sql
SELECT カラム名 FROM テーブルA名 JOIN テーブルB名 ON 結合条件;
```

---

<!-- _class: title-top -->

## 16章まとめ（2/3）

JOIN句には5種類あり、それぞれテーブル結合方法が異なる

| 種類 | 機能 |
|------|------|
| INNER JOIN（内部結合） | 両テーブルで合致するレコードのみを結合 |
| LEFT OUTER JOIN（左外部結合） | 左テーブル基準で結合 |
| RIGHT OUTER JOIN（右外部結合） | 右テーブル基準で結合 |
| FULL OUTER JOIN（完全外部結合） | 両テーブルをそれぞれ基準にして結合 |
| CROSS JOIN（交差結合） | 両テーブルのレコードを総当たりで結合 |

---

<!-- _class: title-top -->

## 16章まとめ（3/3）

```sql
-- 内部結合：両テーブルで合致するレコードのみを結合
SELECT * FROM テーブルA INNER JOIN テーブルB ON 結合条件;

-- 左外部結合：左テーブル基準で結合
SELECT * FROM テーブルA LEFT OUTER JOIN テーブルB ON 結合条件;

-- 右外部結合：右テーブル基準で結合
SELECT * FROM テーブルA RIGHT OUTER JOIN テーブルB ON 結合条件;

-- 交差結合：両テーブルのレコードを総当たりで結合
SELECT * FROM テーブルA CROSS JOIN テーブルB;
```

---

<!-- _class: title -->

# 17章 3つ以上のテーブルを結合しよう

---

<!-- _class: title-top -->

## 17章3つ以上のテーブルを結合しよう

SQLで3つ以上のテーブルを結合する方法を学びます。

### 本章の目標

- SQLで3つ以上のテーブルを結合する方法を知ること

---

<!-- _class: title-top -->

## 17章3つ以上のテーブル結合の概要

<div class="no-bg">

**前章では2つのテーブルを結合する方法を学びましたが、JOIN句を複数使って3テーブル以上の結合も可能です。**

</div>

本章では、SQLで3つ以上のテーブルを結合する方法を学びます。

---

<!-- _class: title-top -->

## 17章3つ以上のテーブルを結合する方法を理解しよう

3つ以上のテーブルを結合する場合、以下のように1つのSELECT文で複数のJOIN句を使います。

```sql
SELECT カラム名
FROM テーブルA名
JOIN テーブルB名 ON 結合条件1
JOIN テーブルC名 ON 結合条件2
JOIN テーブルD名 ON 結合条件3
・・・
JOIN テーブルX名 ON 結合条件n;
```

「JOIN」の部分は、テーブル結合の種類にあわせて置き換えてください。

---

<!-- _class: title-top -->

## 17章結合の実行順序

<div class="no-bg">

**複数テーブルの結合は、上から順に行われます。**

</div>

上記を例にすると、AとBの結合 → Cの結合 → Dの結合…という結合順序です。

![紐づけ](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/ed039b96-9ffc-4855-89ed-7c131c0b9ecb)

---

<!-- _class: title-top -->

## 17章3テーブル結合の具体例

タスクテーブル（tasks）に、外部キーとして担当者IDと優先度IDがあります。これらのIDは、担当者テーブル（staffs）と優先度テーブル（priorities）に紐づいています。

タスクごとの担当者や優先度をリストアップしたいケースを考えましょう。

```sql
SELECT tasks.task_name, staffs.sta_name, priorities.pri_name
FROM tasks
INNER JOIN staffs ON staffs.id = tasks.sta_id
INNER JOIN priorities ON priorities.id = tasks.pri_id;
```

---

<!-- _class: title-top -->

## 17章3テーブル結合の実行結果

タスクテーブルに、担当者テーブルと優先度テーブルを結合し、各々の名称を取得しています。

実行すると、以下のようにタスクごとの担当者・優先度が表示されます。

![実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/be1d3210-257f-40e7-bfa9-22ab52fa6481)

このように、複数のJOIN句を使うことで3テーブル以上の結合が可能です。

---

<!-- _class: title-top -->

## 17章複数のJOIN句を使うときの注意点

<div class="no-bg">

**結合順序によって最終結果が変わる場合があるため注意しましょう。**

</div>

結合順序を間違えると、思ったとおりの結果が得られないこともあります。

たとえば、先ほどの結合順序を優先度テーブル → 担当者テーブルに変更してみます。3行目と4行目が入れ替わっている点に注目してください。

---

<!-- _class: title-top -->

## 17章結合順序による違い

```sql
SELECT tasks.task_name, staffs.sta_name, priorities.pri_name
FROM tasks
INNER JOIN priorities ON priorities.id = tasks.pri_id
INNER JOIN staffs ON staffs.id = tasks.sta_id;
```

上記を実行すると、1レコードの内容は先ほどと同じでも、表示順序まで同じとはなっていません。

![実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/e50c86ce-e7a0-4be5-8b04-75aa58f53b39)

---

<!-- _class: title-top -->

## 17章結合順序の影響

データベースのデータをプログラムから取得する場合、表示順序の違いを考慮しないと想定外の動作になる恐れもあります。

結合時の表示順序を調整したい場合は、ORDER BY句を組み合わせるなどの工夫が必要です。

複雑な結合条件を組み合わせると、表示順序どころかデータの内容が変わることも考えられます。

<div class="no-bg">

**複数テーブルを結合するときは、結合順序による結果への影響も考慮しましょう。**

</div>

---

<!-- _class: title-top -->

## 17章3つのテーブル結合を実行してみよう

では、実際に3つのテーブルを結合してみましょう。

ここでは、タスクテーブルと担当者テーブル、優先度テーブルをINNER JOINで結合してみます。

---

<!-- _class: title-top -->

## 17章3テーブルの結合を実行

では、以下のSQL文を実行してください。

```sql
SELECT tasks.task_name, staffs.sta_name, priorities.pri_name
FROM tasks
INNER JOIN staffs ON staffs.id = tasks.sta_id
INNER JOIN priorities ON priorities.id = tasks.pri_id;
```

以下のように表示されれば、３テーブルの結合は成功です。

![実行結果](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/de7e97d3-075e-4292-8cd2-a627a8999088)

---


<!-- _class: title-top -->

## 17章まとめ

- 3つ以上のテーブルを結合する場合、複数のJOIN句を使う
- 結合順序によって最終結果が変わる場合があるため注意が必要

```sql
SELECT カラム名
FROM テーブルA名
JOIN テーブルB名 ON 結合条件1
JOIN テーブルC名 ON 結合条件2
JOIN テーブルD名 ON 結合条件3
・・・
JOIN テーブルX名 ON 結合条件n;
```

---

<!-- _class: title -->

# 18章 データベースの設計方法を学ぼう

---

<!-- _class: title-top -->

## 18章データベースの設計方法を学ぼう

データベース設計の重要性とER図の概要を学びます。

### 本章の目標

- データベース設計の必要性を知ること
- ER図やリレーションシップの概念を知ること
- ER図の作成方法の基本を知ること

---

<!-- _class: title-top -->

## 18章データベース設計のメリット

データベース設計を適切に行うことによって、以下のようなメリットがあります。

| メリット | 説明 |
|---------|------|
| 効率的なデータ格納 | データへ効率的にアクセスすることができる |
| データの整合性維持 | 不正確なデータ入力やデータ間の矛盾を防ぐことができる |
| 冗長性と重複の削減 | データの重複を最小限に抑えることができる |
| セキュリティの向上 | データへのアクセス制御を行うことで、不正アクセスや個人情報の流出を防ぐことができる |
| パフォーマンス最適化 | SQLの実行時間を短縮できるため、アプリケーション全体の速度向上につながる |

---


<!-- _class: title-top -->

## 18章設計プロセスの3ステップ

データベース設計のプロセスは、大まかに以下のステップで行います。

1. **情報の整理**
   - 開発するアプリケーションで扱う情報をリストアップ
   - 要件を明確にしたうえで必要なデータを整理

2. **データの関係性の分析**
   - 情報がそれぞれどのように関連するかを考える
   - データ同士の関係性（リレーションシップ）を分析

3. **設計図の作成**
   - 情報の種類や関連性をもとに、データ全体の設計図を作成
   - この設計図を「ER図」という

---

<!-- _class: title-top -->

## 18章1. 情報の整理

<div class="no-bg">

![情報の整理](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/5b83dac4-997d-44bf-8ce3-a3c12ff517e7)

この「店舗」や「商品」、「顧客」に当たる部分を「エンティティ」といいます。

エンティティに含まれる属性（名前やメールアドレスなど）を「アトリビュート」といいます。

---

<!-- _class: title-top -->

## 18章2. データの関係性の分析

次に、これらの情報がそれぞれどのように関連するかを考えます。

たとえば、「顧客データと商品データはどのように結びつくか」など、データ同士の関係性を分析して明確にします。

<div class="no-bg">

**このようなデータ間の関係性を「リレーションシップ」といいます。**

</div>

---

<!-- _class: title-top -->

## 18章3. 設計図の作成

そして最後に、これまでまとめた情報の種類や関連性をもとに、Webアプリで扱うデータ全体の設計図を作成します。

<div class="no-bg">

**この設計図を主に「ER図」といいます。**

</div>

この設計図をもとにデータベースを構築し、データを管理します。

これがデータベースにおける「設計」です。

---

<!-- _class: title-top -->

## 18章ER図とリレーションシップを知ろう

データベース設計においてよく使われるER図と、リレーションシップの概念について理解しましょう。

まず、最低限必要な用語について理解しておきましょう。

| 用語 | 説明 |
|------|------|
| ER図 | データの関係性を視覚的に表現した図 |
| エンティティ | 「もの」や「事象」を表す。データベースの「テーブル」に対応する部分 |
| アトリビュート | エンティティが持つ属性。テーブルの「カラム」に対応する部分 |
| リレーションシップ | テーブル同士の関係性 |
| カーディナリティ | リレーションシップの詳細を表す記号 |

---

<!-- _class: title-top -->

## 18章ER図とは

<div class="no-bg">

**ER図（Entity-Relationship Diagram）とは、データの関係性を視覚的に表現した図です。**

</div>

データベース設計では、ER図を使ってデータベースの構造やテーブル間の関係を明確にします。

---

<!-- _class: title-top -->

## 18章ER図とは

<div class="no-bg">

![ER図](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/0e270be1-243d-4446-a396-23d353c57a46)

---

<!-- _class: title-top -->

## 18章ER図の特徴

このように、箱（エンティティ）と線（リレーションシップ）でデータの構造や関連性を表現した図をER図といいます。

この図は基本的に、データベース設計における「設計図」として機能します。

<div class="no-bg">

**ER図を使用することで、データベースの構造を容易に理解し、設計プロセスを効率的に進めることができます。**

</div>

---

<!-- _class: title-top -->

## 18章リレーションシップの種類

#### リレーションシップには主に以下3つの種類があります。

| リレーションシップ | 例 |
|-------------------|-----|
| 1対1 | 「顧客と支払い情報」は「1対1」の関係。1人の顧客は1つの支払い情報（クレジットカード等）を持つ |
| 1対多 | 「顧客と注文」は「1対多」の関係。1人の顧客は複数（多）の注文を行うことができる |
| 多対多 | 「商品と仕入先」は「多対多」の関係。1つの商品は複数の仕入先を持ち、1つの仕入先は複数の商品を提供する |

このようなリレーションシップを「カーディナリティ」という記号を使ってER図で表現します。

---

<!-- _class: title-top -->

## 18章カーディナリティとは

<div class="no-bg">

**カーディナリティは、テーブル同士の対応関係（リレーションシップ）の詳細を記号で表したものです。**

実際は下記のような記号を使用します。リレーションシップの種類を区別した記号で表します。

---

<!-- _class: title-top -->

## 18章カーディナリティとは

</div>

<div class="no-bg">

![カーディナリティとは](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/9424fcad-a40e-4983-83c7-95feedb20f66)

ER図でリレーションシップを表現するときは、カーディナリティも重要な要素となります。

---

<!-- _class: title-top -->

## 18章ER図とリレーションシップの違いとは

<div class="no-bg">

**ER図は、データベースの全体像を表すための設計図です。**

</div>

テーブル同士の関係（リレーションシップ）やテーブルのカラム、プライマリキーなどの情報を図で表現します。

一方、リレーションシップは、ER図の中でテーブル間の関係を示す部分です。

つまり、リレーションシップはER図の一部で表現され、ER図はデータベース設計の全体像を示すものです。

---

<!-- _class: title-top -->

## 18章ER図とリレーションシップの関係

![ER図とリレーションシップ](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/0eb43570-e40b-48af-8d9f-2a58f3859e09)

このように、ER図の中でリレーションシップを表現することができます。

---
<!-- _class: title-top -->

## 18章IE記法について

ER図の記法（書き方のルール）にはさまざまなものがありますが、「IE記法」が最もよく使われています。

IE記法（Information Engineering記法）は、データベース設計の際に使われるER図の表記法の1つです。

---

<!-- _class: title-top -->

## 18章IE記法について

<div class="image-center">

![width:1000px](./images/SQL-21-1.png)

</div>

---

<!-- _class: title-top -->

## 18章IE記法の特徴

この記法は、テーブル間の関係（リレーションシップ）を表す際に「鳥の足のような記号」を使用するため、別名「鳥の足記法」とも呼ばれています。

他の記法に比べて、データの構造やリレーションシップが直感的に理解しやすい特徴があります。

以下は「商品」テーブルと「仕入先」テーブルの関係をIE記法で示したER図です。


---

<!-- _class: title-top -->

## 18章IE記法の特徴

<div class="no-bg">


![IE記法のER図](https://lms-production-media-store.s3-ap-northeast-1.amazonaws.com/assets/images/programs/db-basic-2024ver/973f28ec-035b-4630-a1dc-a3733ff5fbe0)

---

<!-- _class: title-top -->

## 18章まとめ（1/2）

- **データベース設計**とは、データベース内の情報をどのように管理するかを設計するプロセス
- **ER図**とは、データベースの構造やテーブル間の関係を視覚的に表現した図。表記法として「IE記法」が最もよく使われる

---

<!-- _class: title-top -->

## 18章まとめ（2/2）

ER図に関する用語：

| 用語 | 説明 |
|------|------|
| ER図 | データの関係性を視覚的に表現した図 |
| エンティティ | 「もの」や「事象」を表す。データベースの「テーブル」に対応する部分 |
| アトリビュート | エンティティが持つ属性。テーブルの「カラム」に対応する部分 |
| リレーションシップ | テーブル同士の関係性 |
| カーディナリティ | リレーションシップの詳細を表す記号 |

---

<!-- _class: title -->

# 19章 サブクエリを学ぼう

---

<!-- _class: title-top -->

## 19章 サブクエリを学ぼう

より高度なデータ検索を実現するサブクエリの使い方を学びます。

**本章の目標**
- サブクエリとは何かを知ること
- サブクエリの基本的な使い方を理解すること
- サブクエリを活用した実践的なクエリを書けるようになること

---

<!-- _class: title-top -->

## 19章 サブクエリとは

<div class="no-bg">

**サブクエリ**とは、SQL文の中に入れ子（ネスト）にして記述される別のSELECT文のことです。

</div>

- メインのクエリの中に、別のクエリを組み込む
- 複雑な条件を表現できる
- JOINでは実現しにくい検索も可能になる
- 別名「入れ子クエリ」「ネストクエリ」とも呼ばれる

---

<!-- _class: title-top -->

## 19章 サブクエリとは

サブクエリは**括弧 `()` で囲んで記述**します。

```sql
SELECT カラム名
FROM テーブル名
WHERE カラム名 = (サブクエリ);
```

サブクエリ部分が先に実行され、その結果をメインクエリで使用します。

---

<!-- _class: title-top -->

## 19章 サブクエリの基本構文

<div class="no-bg">

**基本的な構文**

</div>

```sql
SELECT カラム名
FROM テーブル名
WHERE カラム名 演算子 (
    SELECT カラム名
    FROM テーブル名
    WHERE 条件
);
```

- 外側のクエリ：**メインクエリ（外部クエリ）**
- 内側のクエリ：**サブクエリ（内部クエリ）**

---

<!-- _class: title-top -->

## 19章 サブクエリの実行順序

サブクエリは**内側から外側に向かって実行**されます。

1. **サブクエリ**が先に実行される
2. サブクエリの結果を使って**メインクエリ**が実行される

この順序を理解することが、サブクエリを使いこなす鍵です。

---

<!-- _class: title-top -->

## 19章 サブクエリの実例

#### 例えば「山田太郎さんと同じ年齢のユーザーを取得したい」場合を考えます。

### **通常の方法（2段階）**
```sql
-- 1. 山田太郎さんの年齢を調べる
SELECT age FROM users WHERE name = '山田太郎';  -- 結果: 25

-- 2. 年齢が25のユーザーを取得
SELECT * FROM users WHERE age = 25;
```

### **サブクエリを使う方法（1回で完結）**
```sql
SELECT * FROM users
WHERE age = (
    SELECT age FROM users WHERE name = '山田太郎'
);
```

---

<!-- _class: title-top -->

## 19章 WHERE句でのサブクエリ

WHERE句でサブクエリを使う場合、サブクエリの結果が**1つの値を返す**必要があります。

```sql
SELECT name, price
FROM products
WHERE price > (
    SELECT AVG(price)
    FROM products
);
```

このクエリは「平均価格より高い商品」を取得します。

---

<!-- _class: title-top -->

## 19章 IN演算子とサブクエリ

サブクエリが**複数の値を返す**場合は、`IN`演算子を使います。

```sql
SELECT name, department_id
FROM employees
WHERE department_id IN (
    SELECT id
    FROM departments
    WHERE location = '東京'
);
```

このクエリは「東京にある部署に所属する社員」を取得します。

---

<!-- _class: title-top -->

## 19章 NOT IN演算子とサブクエリ

`NOT IN`を使うと、サブクエリの結果に**含まれない**データを取得できます。

```sql
SELECT name, price
FROM products
WHERE category_id NOT IN (
    SELECT id
    FROM categories
    WHERE name = '廃盤'
);
```

このクエリは「廃盤カテゴリに属さない商品」を取得します。

---

<!-- _class: title-top -->

## 19章 EXISTS演算子とサブクエリ

<div class="no-bg">

**EXISTS演算子**は、サブクエリの結果が存在するかどうかを判定します。

</div>

```sql
SELECT name
FROM customers
WHERE EXISTS (
    SELECT 1
    FROM orders
    WHERE orders.customer_id = customers.id
);
```

このクエリは「注文履歴がある顧客」を取得します。

---

<!-- _class: title-top -->

## 19章 NOT EXISTS演算子

`NOT EXISTS`を使うと、サブクエリの結果が**存在しない**場合にTRUEになります。

```sql
SELECT name
FROM customers
WHERE NOT EXISTS (
    SELECT 1
    FROM orders
    WHERE orders.customer_id = customers.id
);
```

このクエリは「注文履歴がない顧客」を取得します。

---

<!-- _class: title-top -->

## 19章 FROM句でのサブクエリ

FROM句にサブクエリを記述することもできます。この場合、サブクエリの結果を**仮想テーブル**として扱います。

```sql
SELECT dept_name, avg_salary
FROM (
    SELECT department_id, AVG(salary) AS avg_salary
    FROM employees
    GROUP BY department_id
) AS dept_avg
JOIN departments ON dept_avg.department_id = departments.id;
```

FROM句のサブクエリには**必ずエイリアス（別名）**を付ける必要があります。

---

<!-- _class: title-top -->

## 19章 SELECT句でのサブクエリ

SELECT句にもサブクエリを記述できます。

```sql
SELECT
    name,
    price,
    (SELECT AVG(price) FROM products) AS avg_price,
    price - (SELECT AVG(price) FROM products) AS price_diff
FROM products;
```

各商品の価格と平均価格との差を一覧で取得できます。

---

<!-- _class: title-top -->

## 19章 相関サブクエリ

<div class="no-bg">

**相関サブクエリ**とは、メインクエリのテーブルを参照するサブクエリです。

</div>

```sql
SELECT name, salary
FROM employees e1
WHERE salary > (
    SELECT AVG(salary)
    FROM employees e2
    WHERE e2.department_id = e1.department_id
);
```

このクエリは「各部署の平均給与より高い給与をもらっている社員」を取得します。

---

<!-- _class: title-top -->

## 19章 相関サブクエリの特徴

相関サブクエリは、メインクエリの**各行ごとに実行**されます。

- 通常のサブクエリ：1回だけ実行される
- 相関サブクエリ：メインクエリの行数分実行される

そのため、データ量が多い場合は**パフォーマンスに注意**が必要です。

---

<!-- _class: title-top -->

## 19章 サブクエリとJOINの使い分け

同じ結果を得られる場合でも、サブクエリとJOINのどちらを使うか選択できます。

**サブクエリが適している場合**
- 条件判定に別テーブルのデータを使う
- EXISTS/NOT EXISTSで存在確認をする
- 集計結果を条件に使う

**JOINが適している場合**
- 複数テーブルのカラムを同時に取得する
- 大量データでパフォーマンスが重要

---

<!-- _class: title-top -->

## 19章 サブクエリの実践例①

「最も高い商品と同じ価格の商品を取得」

```sql
SELECT name, price
FROM products
WHERE price = (
    SELECT MAX(price)
    FROM products
);
```

---

<!-- _class: title-top -->

## 19章 サブクエリの実践例②

「注文されたことのある商品のみを取得」

```sql
SELECT name, price
FROM products
WHERE id IN (
    SELECT DISTINCT product_id
    FROM order_details
);
```

`DISTINCT`を使って重複を除いています。

---

<!-- _class: title-top -->

## 19章 サブクエリの実践例③

「各カテゴリで最も高い商品を取得」

```sql
SELECT name, price, category_id
FROM products p1
WHERE price = (
    SELECT MAX(price)
    FROM products p2
    WHERE p2.category_id = p1.category_id
);
```

相関サブクエリを使った例です。

---

<!-- _class: title-top -->

## 19章 サブクエリ使用時の注意点

1. **サブクエリは括弧で囲む**必要がある
2. **FROM句のサブクエリには必ずエイリアスを付ける**
3. WHERE句で使う場合、**返す値の数に注意**（単一値なら`=`、複数値なら`IN`）
4. **相関サブクエリはパフォーマンスに影響**する可能性がある
5. サブクエリが複雑になりすぎたら、**JOINでの書き換えを検討**する

---

<!-- _class: title-top -->

## 19章 WITH句（CTE）とは

<div class="no-bg">

**WITH句**は、クエリの前に一時的な結果セット（共通テーブル式：CTE）を定義する構文です。

</div>

- **CTE**（Common Table Expression：共通テーブル式）とも呼ばれる
- サブクエリを**名前付きで定義**できる
- 複雑なクエリを**読みやすく整理**できる
- 同じサブクエリを**複数回参照**できる

---

<!-- _class: title-top -->

## 19章 WITH句の基本構文

<div class="no-bg">

**基本的な構文**

</div>

```sql
WITH CTE名 AS (
    SELECT カラム名
    FROM テーブル名
    WHERE 条件
)
SELECT カラム名
FROM CTE名;
```

WITH句で定義したCTEは、そのクエリ内でテーブルのように使用できます。

---

<!-- _class: title-top -->

## 19章 WITH句の実例

#### サブクエリを使った書き方とWITH句を使った書き方を比較します。

### **サブクエリを使った書き方**
```sql
SELECT name, price FROM products
WHERE price > (
    SELECT AVG(price) FROM products
);
```

### **WITH句を使った書き方**
```sql
WITH avg_price AS (
    SELECT AVG(price) AS price FROM products
)
SELECT name, price FROM products, avg_price
WHERE products.price > avg_price.price;
```

---

<!-- _class: title-top -->

## 19章 WITH句のメリット

1. **可読性の向上**
   - 複雑なサブクエリに名前を付けて整理できる
   - クエリの意図が分かりやすくなる

2. **再利用性**
   - 同じサブクエリを複数回参照できる
   - コードの重複を避けられる

3. **保守性の向上**
   - 修正箇所が1か所で済む
   - デバッグしやすい

---

<!-- _class: title-top -->

## 19章 WITH句の実践例①

#### 「カテゴリごとの平均価格を計算し、それより高い商品を取得」

```sql
WITH category_avg AS (
    SELECT
        category_id,
        AVG(price) AS avg_price
    FROM products
    GROUP BY category_id
)
SELECT
    p.name,
    p.price,
    p.category_id,
    ca.avg_price
FROM products p
JOIN category_avg ca ON p.category_id = ca.category_id
WHERE p.price > ca.avg_price;
```

---

<!-- _class: title-top -->

## 19章 WITH句の実践例②

#### 「売上TOP10の商品の詳細を取得」

```sql
WITH top_products AS (
    SELECT
        product_id,
        SUM(quantity) AS total_sales
    FROM order_details
    GROUP BY product_id
    ORDER BY total_sales DESC
    LIMIT 10
)
SELECT
    p.name,
    p.price,
    tp.total_sales
FROM products p
JOIN top_products tp ON p.id = tp.product_id
ORDER BY tp.total_sales DESC;
```

---

<!-- _class: title-top -->

## 19章 複数のCTEを定義する

#### WITH句では、カンマ区切りで**複数のCTE**を定義できます。

```sql
WITH
sales_summary AS (
    SELECT product_id, SUM(quantity) AS total_qty
    FROM order_details
    GROUP BY product_id
),
high_price AS (
    SELECT id, name, price
    FROM products
    WHERE price > 1000
)
SELECT
    hp.name,hp.price,ss.total_qty
FROM high_price hp
JOIN sales_summary ss ON hp.id = ss.product_id;
```

---

<!-- _class: title-top -->

## 19章 CTEの連鎖

#### 後のCTEで前のCTEを参照することもできます。

```sql
WITH
category_totals AS (
    SELECT category_id, COUNT(*) AS product_count
    FROM products
    GROUP BY category_id
),
large_categories AS (
    SELECT category_id
    FROM category_totals
    WHERE product_count > 10
)
SELECT p.name, p.category_id
FROM products p
JOIN large_categories lc ON p.category_id = lc.category_id;
```
---

<!-- _class: title-top -->

## 19章 WITH句とサブクエリの使い分け

**WITH句が適している場合**
- サブクエリが複雑で長い
- 同じサブクエリを複数回使う
- クエリの可読性を重視する
- 段階的にデータを加工する

**サブクエリが適している場合**
- シンプルで短いクエリ
- 1回だけ使用する
- パフォーマンスが最優先

---

<!-- _class: title-top -->

## 19章 WITH句使用時の注意点

1. **CTEは一時的**
   - そのクエリ内でのみ有効
   - クエリ実行後は消える

2. **インデックスが使えない場合がある**
   - CTEは一時的な結果セットのため
   - パフォーマンスに注意


---

<!-- _class: title-top -->

## 19章 まとめ（1/3）

**サブクエリについて**
- **サブクエリ**とは、SQL文の中に入れ子にして記述される別のSELECT文
- サブクエリは**括弧で囲んで記述**する
- **内側から外側**に向かって実行される
- WHERE句、FROM句、SELECT句など、さまざまな場所で使用できる

---

<!-- _class: title-top -->

## 19章 まとめ（2/3）

**WITH句（CTE）について**
- **WITH句**は、クエリの前に一時的な結果セットを定義する構文
- サブクエリを**名前付きで定義**できる
- 複雑なクエリを**読みやすく整理**できる
- **複数のCTE**をカンマ区切りで定義可能

---

<!-- _class: title-top -->

## 19章 まとめ（3/3）

サブクエリとWITH句の比較：

| 項目 | サブクエリ | WITH句（CTE） |
|------|------|------|
| 可読性 | 複雑になると読みにくい | 名前を付けて整理できる |
| 再利用 | できない（毎回記述） | 同じクエリ内で再利用可能 |
| 保守性 | 修正箇所が複数になる | 修正箇所が1か所で済む |
| 適用場面 | シンプルなクエリ | 複雑なクエリ、段階的処理 |
